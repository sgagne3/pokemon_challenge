{"version":3,"sources":["ResultTagging.min__45edc409d97327d59af1.js","./src/ui/ResultTagging/ResultTagging.ts"],"names":["webpackJsonpCoveo__temporary","275","module","exports","__webpack_require__","__extends","this","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","value","element","options","bindings","result","ResultTagging","ID","ComponentOptions","initComponentOptions","resolveResult","Assert","exists","componentOptionsModel","field","logger","error","_this","fieldValue","Utils","getFieldValue","isNonEmptyString","tags","split","isNonEmptyArray","_","map","t","trim","tagZone","$$","className","el","appendChild","buildTagIcon","autoCompleteZone","buildTextBox","buildAddIcon","buildClearIcon","buildExistingTags","each","tag","buildTagValue","tagTextBox","text","l","tagIcon","on","defer","focusOnTextBox","append","setAttribute","textBox","focus","tagValue","buildShortenedTagWithTitle","deleteIcon","SVGIcons","icons","checkboxHookExclusionMore","SVGDom","addClassToSVGInContainer","doRemoveTag","toLowerCase","shortenedTag","StringUtils","removeMiddle","clickableValue","title","href","bindFacetEventOnValue","type","placeholder","autoCompletePopup","autoCompleteClass","manageAutocompleteAutoHide","e","keyCode","KEYBOARD","UP_ARROW","DOWN_ARROW","ENTER","manageUpDownEnter","KeyboardUtils","isArrowKeyPushed","populateSuggestions","removeClass","icon","taggingOk","clickable","doAddTag","facetAttributeName","QueryStateModel","getFacetId","facetModel","queryStateModel","get","facets","componentStateModel","atLeastOneFacetIsEnabled","filter","disabled","length","contains","set","without","union","queryController","deferExecuteQuery","beforeExecuteQuery","usageAnalytics","logSearchEvent","analyticsActionCauseList","documentTag","facetId","facetField","facetValue","addClass","clearPopup","hide","empty","showPopup","show","endpoint","getEndpoint","searchText","searchOptions","ignoreAccents","sortCriteria","maximumNumberOfValues","suggestBoxSize","queryOverride","pattern","buildRegEx","patternType","listFieldValues","then","fieldValues","buildSelectableValue","lookupValue","style","width","offsetWidth","timeout","clearTimeout","target","hasClass","setTimeout","autoCompleteTimer","closest","searchTerm","buildTermToExclude","join","term","code","selectableArray","findAll","newIndex","computeNextIndex","Math","max","min","selected","nextIndex","selectable","index","line","doAddTagWithValue","request","fieldName","doAdd","uniqueId","tagDocument","splice","indexOf","detach","doAddSingleTagValue","push","catch","findWhere","doExport","exportGlobally","buildFieldOption","match","required","buildNumberOption","defaultValue","AUTO_COMPLETE_CLASS","Component","Initialization","registerAutoCreateComponent","662"],"mappings":"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","file":"ResultTagging.min__45edc409d97327d59af1.js","sourcesContent":["webpackJsonpCoveo__temporary([61],{\n\n/***/ 275:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(662);\nvar _ = __webpack_require__(0);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Assert_1 = __webpack_require__(5);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar KeyboardUtils_1 = __webpack_require__(25);\nvar StringUtils_1 = __webpack_require__(22);\nvar SVGDom_1 = __webpack_require__(16);\nvar SVGIcons_1 = __webpack_require__(12);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\n/**\n * The ResultTagging component lists the current tag field values of its associated result and renders a control that\n * allows the end user to add values to a tag field.\n *\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\n *\n * **Note:**\n * > The ResultTagging component is not supported with Coveo Cloud V2. To implement the ResultTagging component in Coveo Cloud V1, contact [Coveo Support](https://support.coveo.com/s/).\n *\n * @notSupportedIn salesforcefree\n */\nvar ResultTagging = /** @class */ (function (_super) {\n    __extends(ResultTagging, _super);\n    /**\n     * Creates a new ResultTagging component.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the ResultTagging component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     * @param result The result to associate the component with.\n     */\n    function ResultTagging(element, options, bindings, result) {\n        var _this = _super.call(this, element, ResultTagging.ID, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.result = result;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, ResultTagging, options);\n        _this.result = result || _this.resolveResult();\n        Assert_1.Assert.exists(_this.componentOptionsModel);\n        Assert_1.Assert.exists(_this.result);\n        if (!_this.options.field) {\n            _this.logger.error('You must specify a field to the ResultTagging component');\n            return _this;\n        }\n        var fieldValue = Utils_1.Utils.getFieldValue(_this.result, _this.options.field);\n        if (fieldValue && Utils_1.Utils.isNonEmptyString(fieldValue)) {\n            _this.tags = fieldValue.split(';');\n        }\n        else if (fieldValue && Utils_1.Utils.isNonEmptyArray(fieldValue)) {\n            _this.tags = fieldValue;\n        }\n        else {\n            _this.tags = [];\n        }\n        _this.tags = _.map(_this.tags, function (t) {\n            return t.trim();\n        });\n        _this.tagZone = Dom_1.$$('div', {\n            className: 'coveo-result-tagging-tag-zone'\n        }).el;\n        element.appendChild(_this.tagZone);\n        element.appendChild(_this.buildTagIcon());\n        _this.autoCompleteZone = Dom_1.$$('div', {\n            className: 'coveo-result-tagging-auto-complete-zone'\n        }).el;\n        element.appendChild(_this.autoCompleteZone);\n        _this.autoCompleteZone.appendChild(_this.buildTextBox());\n        _this.autoCompleteZone.appendChild(_this.buildAddIcon());\n        _this.autoCompleteZone.appendChild(_this.buildClearIcon());\n        _this.buildExistingTags();\n        return _this;\n    }\n    ResultTagging.prototype.buildExistingTags = function () {\n        var _this = this;\n        if (this.tags) {\n            _.each(this.tags, function (tag) {\n                _this.tagZone.appendChild(_this.buildTagValue(tag));\n            });\n        }\n    };\n    ResultTagging.prototype.buildTagIcon = function () {\n        var _this = this;\n        var tagZone = Dom_1.$$('div', {\n            className: 'coveo-result-tagging-add-tag'\n        });\n        var tagTextBox = Dom_1.$$('span', {\n            className: 'coveo-result-tagging-add-tag-text'\n        });\n        tagTextBox.text(Strings_1.l('EnterTag'));\n        var tagIcon = Dom_1.$$('span', {\n            className: 'coveo-result-tagging-add-tag-icon'\n        });\n        tagIcon.on('click', function () {\n            _.defer(function () {\n                _this.focusOnTextBox();\n            }, 20);\n        });\n        tagZone.el.appendChild(tagIcon.el);\n        tagZone.append(tagTextBox.el);\n        tagZone.setAttribute('title', Strings_1.l('EnterTag'));\n        return tagZone.el;\n    };\n    ResultTagging.prototype.focusOnTextBox = function () {\n        this.textBox.focus();\n    };\n    ResultTagging.prototype.buildTagValue = function (tagValue) {\n        var _this = this;\n        var tag = Dom_1.$$('div', {\n            className: 'coveo-result-tagging-coveo-tag'\n        });\n        tag.el.appendChild(this.buildShortenedTagWithTitle(tagValue));\n        var deleteIcon = Dom_1.$$('span', {\n            className: 'coveo-result-tagging-delete-icon'\n        }, SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(deleteIcon.el, 'coveo-result-tagging-delete-icon-svg');\n        tag.el.appendChild(deleteIcon.el);\n        deleteIcon.on('click', function () {\n            _this.doRemoveTag(tag.el, tagValue.toLowerCase());\n        });\n        return tag.el;\n    };\n    ResultTagging.prototype.buildShortenedTagWithTitle = function (tagValue) {\n        var shortenedTag = StringUtils_1.StringUtils.removeMiddle(tagValue, 16, '...');\n        var clickableValue = Dom_1.$$('a', {\n            title: tagValue,\n            href: 'javascript:void(0);'\n        });\n        clickableValue.text(shortenedTag);\n        this.bindFacetEventOnValue(clickableValue.el, tagValue);\n        return clickableValue.el;\n    };\n    ResultTagging.prototype.buildTextBox = function () {\n        var _this = this;\n        this.textBox = Dom_1.$$('input', {\n            type: 'text',\n            className: 'coveo-add-tag-textbox',\n            placeholder: Strings_1.l('EnterTag')\n        }).el;\n        this.autoCompletePopup = Dom_1.$$('div', {\n            className: ResultTagging.autoCompleteClass\n        }).el;\n        this.autoCompleteZone.appendChild(this.autoCompletePopup);\n        this.manageAutocompleteAutoHide();\n        Dom_1.$$(this.textBox).on('keyup', function (e) {\n            if (e.keyCode == KeyboardUtils_1.KEYBOARD.UP_ARROW || e.keyCode == KeyboardUtils_1.KEYBOARD.DOWN_ARROW || e.keyCode == KeyboardUtils_1.KEYBOARD.ENTER) {\n                _this.manageUpDownEnter(e.keyCode);\n            }\n            else if (!KeyboardUtils_1.KeyboardUtils.isArrowKeyPushed(e.keyCode)) {\n                _this.populateSuggestions();\n            }\n            Dom_1.$$(_this.element).removeClass('coveo-error');\n        });\n        Dom_1.$$(this.textBox).on('click', function () {\n            _this.populateSuggestions();\n        });\n        return this.textBox;\n    };\n    ResultTagging.prototype.buildAddIcon = function () {\n        var _this = this;\n        var icon = Dom_1.$$('div', {\n            className: 'coveo-result-tagging-add-tag-tick-icon'\n        }, SVGIcons_1.SVGIcons.icons.taggingOk);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(icon.el, 'coveo-result-tagging-add-tag-tick-icon-svg');\n        var clickable = Dom_1.$$('span');\n        clickable.on('click', function () {\n            _this.doAddTag();\n        });\n        icon.el.appendChild(clickable.el);\n        return icon.el;\n    };\n    ResultTagging.prototype.buildClearIcon = function () {\n        var _this = this;\n        var icon = Dom_1.$$('div', {\n            className: 'coveo-result-tagging-clear-icon'\n        }, SVGIcons_1.SVGIcons.icons.checkboxHookExclusionMore);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(icon.el, 'coveo-result-tagging-clear-icon-svg');\n        var clickable = Dom_1.$$('span');\n        clickable.on('click', function () {\n            _this.textBox.value = '';\n        });\n        icon.el.appendChild(clickable.el);\n        return icon.el;\n    };\n    ResultTagging.prototype.bindFacetEventOnValue = function (element, value) {\n        var _this = this;\n        var facetAttributeName = QueryStateModel_1.QueryStateModel.getFacetId(this.options.field);\n        var facetModel = this.queryStateModel.get(facetAttributeName);\n        var facets = this.componentStateModel.get(facetAttributeName);\n        var atLeastOneFacetIsEnabled = _.filter(facets, function (value) { return !value.disabled; }).length > 0;\n        if (facetModel != null && atLeastOneFacetIsEnabled) {\n            Dom_1.$$(element).on('click', function () {\n                if (_.contains(facetModel, value)) {\n                    _this.queryStateModel.set(facetAttributeName, _.without(facetModel, value));\n                }\n                else {\n                    _this.queryStateModel.set(facetAttributeName, _.union(facetModel, [value]));\n                }\n                _this.queryController.deferExecuteQuery({\n                    beforeExecuteQuery: function () {\n                        return _this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.documentTag, {\n                            facetId: _this.options.field,\n                            facetField: _this.options.field,\n                            facetValue: value\n                        });\n                    }\n                });\n            });\n            if (_.contains(facetModel, value)) {\n                Dom_1.$$(element).addClass('coveo-selected');\n            }\n            Dom_1.$$(element).addClass('coveo-clickable');\n        }\n    };\n    ResultTagging.prototype.clearPopup = function () {\n        Dom_1.$$(this.autoCompletePopup).hide();\n        Dom_1.$$(this.autoCompletePopup).empty();\n    };\n    ResultTagging.prototype.showPopup = function () {\n        Dom_1.$$(this.autoCompletePopup).show();\n    };\n    ResultTagging.prototype.populateSuggestions = function () {\n        var _this = this;\n        var endpoint = this.queryController.getEndpoint();\n        var searchText = this.textBox.value;\n        var searchOptions = {\n            field: this.options.field,\n            ignoreAccents: true,\n            sortCriteria: 'occurences',\n            maximumNumberOfValues: this.options.suggestBoxSize,\n            queryOverride: '@uri',\n            pattern: this.buildRegEx(searchText),\n            patternType: 'RegularExpression'\n        };\n        endpoint.listFieldValues(searchOptions).then(function (fieldValues) {\n            _this.clearPopup();\n            _.each(fieldValues, function (fieldValue) {\n                _this.autoCompletePopup.appendChild(_this.buildSelectableValue(fieldValue.lookupValue));\n            });\n            _this.showPopup();\n            _this.autoCompletePopup.style.width = _this.textBox.offsetWidth + ' px';\n        });\n    };\n    ResultTagging.prototype.manageAutocompleteAutoHide = function () {\n        var _this = this;\n        var timeout;\n        Dom_1.$$(this.textBox).on('mouseover', function () {\n            clearTimeout(timeout);\n        });\n        Dom_1.$$(this.autoCompletePopup).on('mouseout', function (e) {\n            if (Dom_1.$$(e.target).hasClass(ResultTagging.autoCompleteClass)) {\n                timeout = setTimeout(function () {\n                    _this.clearPopup();\n                }, _this.options.autoCompleteTimer);\n            }\n        });\n        Dom_1.$$(this.autoCompletePopup).on('mouseenter', function () {\n            clearTimeout(timeout);\n        });\n        Dom_1.$$(this.element).on('mouseenter', function () {\n            _this.clearPopup();\n            Dom_1.$$(_this.element).addClass('coveo-opened');\n        });\n        Dom_1.$$(Dom_1.$$(this.element).closest('.CoveoResult')).on('mouseleave', function () {\n            _this.clearPopup();\n            if (_this.textBox.value == '') {\n                Dom_1.$$(_this.element).removeClass('coveo-opened');\n            }\n        });\n        Dom_1.$$(Dom_1.$$(this.element).closest('.CoveoResult')).on('focusout', function (e) {\n            if (_this.textBox.value != '' && Dom_1.$$(e.target).closest('.CoveoResult') != Dom_1.$$(_this.element).closest('.CoveoResult')) {\n                Dom_1.$$(_this.element).addClass('coveo-error');\n            }\n        });\n        Dom_1.$$(Dom_1.$$(this.element).closest('.CoveoResult')).on('focusin', function () {\n            Dom_1.$$(_this.element).removeClass('coveo-error');\n        });\n    };\n    // Exclude tags that are already on the result (Since we can tag with the same value twice.\n    ResultTagging.prototype.buildRegEx = function (searchTerm) {\n        var _this = this;\n        return '(?=.*' + searchTerm + ')' + _.map(this.tags, function (tag) { return _this.buildTermToExclude(tag); }).join('') + '.*';\n    };\n    ResultTagging.prototype.buildTermToExclude = function (term) {\n        return '(?!^' + term + '$)';\n    };\n    ResultTagging.prototype.manageUpDownEnter = function (code) {\n        var selectableArray = Dom_1.$$(this.element).findAll('.coveo-selectable');\n        if (code == KeyboardUtils_1.KEYBOARD.ENTER) {\n            this.doAddTag();\n            return;\n        }\n        if (selectableArray.length > 0) {\n            var newIndex = this.computeNextIndex(code, selectableArray);\n            newIndex = Math.max(0, newIndex);\n            newIndex = Math.min(selectableArray.length - 1, newIndex);\n            var selected = Dom_1.$$(selectableArray[newIndex]);\n            selected.addClass('coveo-selected');\n            this.textBox.value = selected.text();\n        }\n    };\n    ResultTagging.prototype.computeNextIndex = function (code, selectableArray) {\n        var nextIndex = 0;\n        _.each(selectableArray, function (selectable, index) {\n            if (Dom_1.$$(selectable).hasClass('coveo-selected')) {\n                if (code == KeyboardUtils_1.KEYBOARD.UP_ARROW) {\n                    nextIndex = index - 1;\n                }\n                else if (code == KeyboardUtils_1.KEYBOARD.DOWN_ARROW) {\n                    nextIndex = index + 1;\n                }\n                Dom_1.$$(selectable).removeClass('coveo-selected');\n            }\n        });\n        return nextIndex;\n    };\n    ResultTagging.prototype.buildSelectableValue = function (lookupValue) {\n        var _this = this;\n        var line = Dom_1.$$('div', {\n            className: 'coveo-selectable'\n        });\n        line.el.appendChild(this.buildShortenedTagWithTitle(lookupValue));\n        line.on('click', function () {\n            _this.doAddTagWithValue(lookupValue);\n        });\n        return line.el;\n    };\n    ResultTagging.prototype.doRemoveTag = function (element, tagValue) {\n        var _this = this;\n        var request = {\n            fieldName: this.options.field,\n            fieldValue: tagValue,\n            doAdd: false,\n            uniqueId: this.result.uniqueId\n        };\n        this.queryController\n            .getEndpoint()\n            .tagDocument(request)\n            .then(function () {\n            _this.tags.splice(_.indexOf(_this.tags, tagValue), 1);\n            Dom_1.$$(element).detach();\n        });\n    };\n    ResultTagging.prototype.doAddTagWithValue = function (tagValue) {\n        var _this = this;\n        _.each(tagValue.split(','), function (tag) {\n            _this.doAddSingleTagValue(tag);\n        });\n    };\n    ResultTagging.prototype.doAddSingleTagValue = function (tagValue) {\n        var _this = this;\n        this.clearPopup();\n        if (_.indexOf(this.tags, tagValue) > -1) {\n            Dom_1.$$(this.element).addClass('coveo-error');\n            return;\n        }\n        this.tags.push(tagValue);\n        var request = {\n            fieldName: this.options.field,\n            fieldValue: tagValue,\n            doAdd: true,\n            uniqueId: this.result.uniqueId\n        };\n        this.queryController\n            .getEndpoint()\n            .tagDocument(request)\n            .then(function () {\n            _this.tagZone.appendChild(_this.buildTagValue(tagValue));\n            _this.textBox.value = '';\n            Dom_1.$$(_this.element).removeClass('coveo-error');\n        })\n            .catch(function () {\n            // We do this otherwise it's possible to add the same tag while we wait for the server's response\n            _this.tags = _.without(_this.tags, _.findWhere(_this.tags, tagValue));\n        });\n    };\n    ResultTagging.prototype.doAddTag = function () {\n        var tagValue = Utils_1.Utils.trim(this.textBox.value.toLowerCase());\n        this.doAddTagWithValue(tagValue);\n    };\n    ResultTagging.ID = 'ResultTagging';\n    ResultTagging.autoCompleteClass = 'coveo-result-tagging-auto-complete';\n    ResultTagging.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            ResultTagging: ResultTagging\n        });\n    };\n    /**\n     * @componentOptions\n     */\n    ResultTagging.options = {\n        /**\n         * Specifies the tag field that the component will use.\n         *\n         * Specifying a value for this options is necessary for this component to work.\n         */\n        field: ComponentOptions_1.ComponentOptions.buildFieldOption({\n            match: function (field) { return field.type == 'Tag'; },\n            required: true\n        }),\n        /**\n         * Specifies the number of items to show in the list of suggested items.\n         *\n         * Default value is `5`. Minimum value is `0 `.\n         */\n        suggestBoxSize: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0 }),\n        /**\n         * Specifies how much time (in milliseconds) it takes for the list of suggested items to disappear when it loses\n         * focus.\n         *\n         * Default value is `2000`. Minimum value is `0`.\n         */\n        autoCompleteTimer: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 2000, min: 0 })\n    };\n    ResultTagging.AUTO_COMPLETE_CLASS = 'coveo-result-tagging-auto-complete';\n    return ResultTagging;\n}(Component_1.Component));\nexports.ResultTagging = ResultTagging;\nInitialization_1.Initialization.registerAutoCreateComponent(ResultTagging);\n\n\n/***/ }),\n\n/***/ 662:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// ResultTagging.min__45edc409d97327d59af1.js","import 'styling/_ResultTagging';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Assert } from '../../misc/Assert';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport { IFieldDescription } from '../../rest/FieldDescription';\nimport { IIndexFieldValue } from '../../rest/FieldValue';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { ITaggingRequest } from '../../rest/TaggingRequest';\nimport { l } from '../../strings/Strings';\nimport { $$ } from '../../utils/Dom';\nimport { KEYBOARD, KeyboardUtils } from '../../utils/KeyboardUtils';\nimport { StringUtils } from '../../utils/StringUtils';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { Utils } from '../../utils/Utils';\nimport { analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IFieldOption } from '../Base/IComponentOptions';\nimport { Initialization } from '../Base/Initialization';\n\nexport interface IResultTaggingOptions {\n  field: IFieldOption;\n  suggestBoxSize?: number;\n  autoCompleteTimer?: number;\n}\n\nexport interface IAnalyticsResultTaggingMeta {\n  facetId: string;\n  facetField: string;\n  facetValue?: string;\n  facetTitle?: string;\n}\n\n/**\n * The ResultTagging component lists the current tag field values of its associated result and renders a control that\n * allows the end user to add values to a tag field.\n *\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\n *\n * **Note:**\n * > The ResultTagging component is not supported with Coveo Cloud V2. To implement the ResultTagging component in Coveo Cloud V1, contact [Coveo Support](https://support.coveo.com/s/).\n *\n * @notSupportedIn salesforcefree\n */\nexport class ResultTagging extends Component {\n  static ID = 'ResultTagging';\n  static autoCompleteClass = 'coveo-result-tagging-auto-complete';\n\n  static doExport = () => {\n    exportGlobally({\n      ResultTagging: ResultTagging\n    });\n  };\n\n  /**\n   * @componentOptions\n   */\n  static options: IResultTaggingOptions = {\n    /**\n     * Specifies the tag field that the component will use.\n     *\n     * Specifying a value for this options is necessary for this component to work.\n     */\n    field: ComponentOptions.buildFieldOption({\n      match: (field: IFieldDescription) => field.type == 'Tag',\n      required: true\n    }),\n\n    /**\n     * Specifies the number of items to show in the list of suggested items.\n     *\n     * Default value is `5`. Minimum value is `0 `.\n     */\n    suggestBoxSize: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0 }),\n\n    /**\n     * Specifies how much time (in milliseconds) it takes for the list of suggested items to disappear when it loses\n     * focus.\n     *\n     * Default value is `2000`. Minimum value is `0`.\n     */\n    autoCompleteTimer: ComponentOptions.buildNumberOption({ defaultValue: 2000, min: 0 })\n  };\n\n  static AUTO_COMPLETE_CLASS = 'coveo-result-tagging-auto-complete';\n\n  private autoCompleteZone: HTMLElement;\n  private textBox: HTMLInputElement;\n  private autoCompletePopup: HTMLElement;\n  private tagZone: HTMLElement;\n  private tags: string[];\n\n  /**\n   * Creates a new ResultTagging component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the ResultTagging component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param result The result to associate the component with.\n   */\n  constructor(\n    public element: HTMLElement,\n    public options?: IResultTaggingOptions,\n    bindings?: IComponentBindings,\n    public result?: IQueryResult\n  ) {\n    super(element, ResultTagging.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, ResultTagging, options);\n    this.result = result || this.resolveResult();\n    Assert.exists(this.componentOptionsModel);\n    Assert.exists(this.result);\n\n    if (!this.options.field) {\n      this.logger.error('You must specify a field to the ResultTagging component');\n      return;\n    }\n    let fieldValue = Utils.getFieldValue(this.result, <string>this.options.field);\n    if (fieldValue && Utils.isNonEmptyString(fieldValue)) {\n      this.tags = fieldValue.split(';');\n    } else if (fieldValue && Utils.isNonEmptyArray(fieldValue)) {\n      this.tags = fieldValue;\n    } else {\n      this.tags = [];\n    }\n    this.tags = _.map(this.tags, t => {\n      return t.trim();\n    });\n    this.tagZone = $$('div', {\n      className: 'coveo-result-tagging-tag-zone'\n    }).el;\n    element.appendChild(this.tagZone);\n    element.appendChild(this.buildTagIcon());\n\n    this.autoCompleteZone = $$('div', {\n      className: 'coveo-result-tagging-auto-complete-zone'\n    }).el;\n    element.appendChild(this.autoCompleteZone);\n    this.autoCompleteZone.appendChild(this.buildTextBox());\n    this.autoCompleteZone.appendChild(this.buildAddIcon());\n    this.autoCompleteZone.appendChild(this.buildClearIcon());\n    this.buildExistingTags();\n  }\n\n  private buildExistingTags() {\n    if (this.tags) {\n      _.each(this.tags, (tag: string) => {\n        this.tagZone.appendChild(this.buildTagValue(tag));\n      });\n    }\n  }\n\n  private buildTagIcon(): HTMLElement {\n    let tagZone = $$('div', {\n      className: 'coveo-result-tagging-add-tag'\n    });\n    let tagTextBox = $$('span', {\n      className: 'coveo-result-tagging-add-tag-text'\n    });\n    tagTextBox.text(l('EnterTag'));\n    let tagIcon = $$('span', {\n      className: 'coveo-result-tagging-add-tag-icon'\n    });\n    tagIcon.on('click', () => {\n      _.defer(() => {\n        this.focusOnTextBox();\n      }, 20);\n    });\n    tagZone.el.appendChild(tagIcon.el);\n    tagZone.append(tagTextBox.el);\n    tagZone.setAttribute('title', l('EnterTag'));\n    return tagZone.el;\n  }\n\n  private focusOnTextBox() {\n    this.textBox.focus();\n  }\n\n  private buildTagValue(tagValue: string): HTMLElement {\n    let tag = $$('div', {\n      className: 'coveo-result-tagging-coveo-tag'\n    });\n    tag.el.appendChild(this.buildShortenedTagWithTitle(tagValue));\n    let deleteIcon = $$(\n      'span',\n      {\n        className: 'coveo-result-tagging-delete-icon'\n      },\n      SVGIcons.icons.checkboxHookExclusionMore\n    );\n    SVGDom.addClassToSVGInContainer(deleteIcon.el, 'coveo-result-tagging-delete-icon-svg');\n    tag.el.appendChild(deleteIcon.el);\n    deleteIcon.on('click', () => {\n      this.doRemoveTag(tag.el, tagValue.toLowerCase());\n    });\n    return tag.el;\n  }\n\n  private buildShortenedTagWithTitle(tagValue: string): HTMLElement {\n    let shortenedTag = StringUtils.removeMiddle(tagValue, 16, '...');\n    let clickableValue = $$('a', {\n      title: tagValue,\n      href: 'javascript:void(0);'\n    });\n    clickableValue.text(shortenedTag);\n\n    this.bindFacetEventOnValue(clickableValue.el, tagValue);\n    return clickableValue.el;\n  }\n\n  private buildTextBox(): HTMLInputElement {\n    this.textBox = <HTMLInputElement>$$('input', {\n      type: 'text',\n      className: 'coveo-add-tag-textbox',\n      placeholder: l('EnterTag')\n    }).el;\n\n    this.autoCompletePopup = $$('div', {\n      className: ResultTagging.autoCompleteClass\n    }).el;\n    this.autoCompleteZone.appendChild(this.autoCompletePopup);\n    this.manageAutocompleteAutoHide();\n    $$(this.textBox).on('keyup', (e: KeyboardEvent) => {\n      if (e.keyCode == KEYBOARD.UP_ARROW || e.keyCode == KEYBOARD.DOWN_ARROW || e.keyCode == KEYBOARD.ENTER) {\n        this.manageUpDownEnter(e.keyCode);\n      } else if (!KeyboardUtils.isArrowKeyPushed(e.keyCode)) {\n        this.populateSuggestions();\n      }\n      $$(this.element).removeClass('coveo-error');\n    });\n    $$(this.textBox).on('click', () => {\n      this.populateSuggestions();\n    });\n    return this.textBox;\n  }\n\n  private buildAddIcon(): HTMLElement {\n    let icon = $$(\n      'div',\n      {\n        className: 'coveo-result-tagging-add-tag-tick-icon'\n      },\n      SVGIcons.icons.taggingOk\n    );\n    SVGDom.addClassToSVGInContainer(icon.el, 'coveo-result-tagging-add-tag-tick-icon-svg');\n    let clickable = $$('span');\n    clickable.on('click', () => {\n      this.doAddTag();\n    });\n    icon.el.appendChild(clickable.el);\n    return icon.el;\n  }\n\n  private buildClearIcon(): HTMLElement {\n    let icon = $$(\n      'div',\n      {\n        className: 'coveo-result-tagging-clear-icon'\n      },\n      SVGIcons.icons.checkboxHookExclusionMore\n    );\n    SVGDom.addClassToSVGInContainer(icon.el, 'coveo-result-tagging-clear-icon-svg');\n    let clickable = $$('span');\n    clickable.on('click', () => {\n      this.textBox.value = '';\n    });\n    icon.el.appendChild(clickable.el);\n    return icon.el;\n  }\n\n  private bindFacetEventOnValue(element: HTMLElement, value: string) {\n    let facetAttributeName = QueryStateModel.getFacetId(<string>this.options.field);\n    let facetModel: string[] = this.queryStateModel.get(facetAttributeName);\n    let facets: Component[] = this.componentStateModel.get(facetAttributeName);\n    let atLeastOneFacetIsEnabled = _.filter(facets, (value: Component) => !value.disabled).length > 0;\n\n    if (facetModel != null && atLeastOneFacetIsEnabled) {\n      $$(element).on('click', () => {\n        if (_.contains(facetModel, value)) {\n          this.queryStateModel.set(facetAttributeName, _.without(facetModel, value));\n        } else {\n          this.queryStateModel.set(facetAttributeName, _.union(facetModel, [value]));\n        }\n        this.queryController.deferExecuteQuery({\n          beforeExecuteQuery: () =>\n            this.usageAnalytics.logSearchEvent<IAnalyticsResultTaggingMeta>(analyticsActionCauseList.documentTag, {\n              facetId: <string>this.options.field,\n              facetField: <string>this.options.field,\n              facetValue: value\n            })\n        });\n      });\n\n      if (_.contains(facetModel, value)) {\n        $$(element).addClass('coveo-selected');\n      }\n      $$(element).addClass('coveo-clickable');\n    }\n  }\n\n  private clearPopup() {\n    $$(this.autoCompletePopup).hide();\n    $$(this.autoCompletePopup).empty();\n  }\n\n  private showPopup() {\n    $$(this.autoCompletePopup).show();\n  }\n\n  private populateSuggestions() {\n    let endpoint = this.queryController.getEndpoint();\n    let searchText = this.textBox.value;\n    let searchOptions = {\n      field: <string>this.options.field,\n      ignoreAccents: true,\n      sortCriteria: 'occurences',\n      maximumNumberOfValues: this.options.suggestBoxSize,\n      queryOverride: '@uri',\n      pattern: this.buildRegEx(searchText),\n      patternType: 'RegularExpression'\n    };\n    endpoint.listFieldValues(searchOptions).then((fieldValues: IIndexFieldValue[]) => {\n      this.clearPopup();\n      _.each(fieldValues, (fieldValue: IIndexFieldValue) => {\n        this.autoCompletePopup.appendChild(this.buildSelectableValue(fieldValue.lookupValue));\n      });\n      this.showPopup();\n      this.autoCompletePopup.style.width = this.textBox.offsetWidth + ' px';\n    });\n  }\n\n  private manageAutocompleteAutoHide() {\n    let timeout: any;\n\n    $$(this.textBox).on('mouseover', () => {\n      clearTimeout(timeout);\n    });\n\n    $$(this.autoCompletePopup).on('mouseout', e => {\n      if ($$(<HTMLElement>e.target).hasClass(ResultTagging.autoCompleteClass)) {\n        timeout = setTimeout(() => {\n          this.clearPopup();\n        }, this.options.autoCompleteTimer);\n      }\n    });\n\n    $$(this.autoCompletePopup).on('mouseenter', () => {\n      clearTimeout(timeout);\n    });\n\n    $$(this.element).on('mouseenter', () => {\n      this.clearPopup();\n      $$(this.element).addClass('coveo-opened');\n    });\n\n    $$($$(this.element).closest('.CoveoResult')).on('mouseleave', () => {\n      this.clearPopup();\n      if (this.textBox.value == '') {\n        $$(this.element).removeClass('coveo-opened');\n      }\n    });\n\n    $$($$(this.element).closest('.CoveoResult')).on('focusout', e => {\n      if (this.textBox.value != '' && $$(<HTMLElement>e.target).closest('.CoveoResult') != $$(this.element).closest('.CoveoResult')) {\n        $$(this.element).addClass('coveo-error');\n      }\n    });\n\n    $$($$(this.element).closest('.CoveoResult')).on('focusin', () => {\n      $$(this.element).removeClass('coveo-error');\n    });\n  }\n\n  // Exclude tags that are already on the result (Since we can tag with the same value twice.\n  private buildRegEx(searchTerm: string) {\n    return '(?=.*' + searchTerm + ')' + _.map(this.tags, (tag: string) => this.buildTermToExclude(tag)).join('') + '.*';\n  }\n\n  private buildTermToExclude(term: string) {\n    return '(?!^' + term + '$)';\n  }\n\n  private manageUpDownEnter(code: number) {\n    let selectableArray = $$(this.element).findAll('.coveo-selectable');\n    if (code == KEYBOARD.ENTER) {\n      this.doAddTag();\n      return;\n    }\n\n    if (selectableArray.length > 0) {\n      let newIndex = this.computeNextIndex(code, selectableArray);\n      newIndex = Math.max(0, newIndex);\n      newIndex = Math.min(selectableArray.length - 1, newIndex);\n      let selected = $$(selectableArray[newIndex]);\n      selected.addClass('coveo-selected');\n      this.textBox.value = selected.text();\n    }\n  }\n\n  private computeNextIndex(code: number, selectableArray: HTMLElement[]): number {\n    let nextIndex = 0;\n    _.each(selectableArray, (selectable: HTMLElement, index) => {\n      if ($$(selectable).hasClass('coveo-selected')) {\n        if (code == KEYBOARD.UP_ARROW) {\n          nextIndex = index - 1;\n        } else if (code == KEYBOARD.DOWN_ARROW) {\n          nextIndex = index + 1;\n        }\n        $$(selectable).removeClass('coveo-selected');\n      }\n    });\n    return nextIndex;\n  }\n\n  private buildSelectableValue(lookupValue: string): HTMLElement {\n    let line = $$('div', {\n      className: 'coveo-selectable'\n    });\n    line.el.appendChild(this.buildShortenedTagWithTitle(lookupValue));\n    line.on('click', () => {\n      this.doAddTagWithValue(lookupValue);\n    });\n    return line.el;\n  }\n\n  private doRemoveTag(element: HTMLElement, tagValue: string) {\n    let request: ITaggingRequest = {\n      fieldName: <string>this.options.field,\n      fieldValue: tagValue,\n      doAdd: false,\n      uniqueId: this.result.uniqueId\n    };\n    this.queryController\n      .getEndpoint()\n      .tagDocument(request)\n      .then(() => {\n        this.tags.splice(_.indexOf(this.tags, tagValue), 1);\n        $$(element).detach();\n      });\n  }\n\n  private doAddTagWithValue(tagValue: string) {\n    _.each(tagValue.split(','), (tag: string) => {\n      this.doAddSingleTagValue(tag);\n    });\n  }\n\n  private doAddSingleTagValue(tagValue: string) {\n    this.clearPopup();\n    if (_.indexOf(this.tags, tagValue) > -1) {\n      $$(this.element).addClass('coveo-error');\n      return;\n    }\n    this.tags.push(tagValue);\n    let request: ITaggingRequest = {\n      fieldName: <string>this.options.field,\n      fieldValue: tagValue,\n      doAdd: true,\n      uniqueId: this.result.uniqueId\n    };\n    this.queryController\n      .getEndpoint()\n      .tagDocument(request)\n      .then(() => {\n        this.tagZone.appendChild(this.buildTagValue(tagValue));\n        this.textBox.value = '';\n        $$(this.element).removeClass('coveo-error');\n      })\n      .catch(() => {\n        // We do this otherwise it's possible to add the same tag while we wait for the server's response\n        this.tags = _.without(this.tags, _.findWhere(this.tags, tagValue));\n      });\n  }\n\n  private doAddTag() {\n    let tagValue = Utils.trim(this.textBox.value.toLowerCase());\n    this.doAddTagWithValue(tagValue);\n  }\n}\nInitialization.registerAutoCreateComponent(ResultTagging);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultTagging/ResultTagging.ts"],"sourceRoot":""}