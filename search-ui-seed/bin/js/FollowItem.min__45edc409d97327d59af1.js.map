{"version":3,"sources":["FollowItem.min__45edc409d97327d59af1.js","./src/rest/Subscription.ts","./src/ui/FollowItem/FollowItem.ts"],"names":["webpackJsonpCoveo__temporary","226","module","exports","__webpack_require__","Object","defineProperty","value","SUBSCRIPTION_TYPE","followQuery","followDocument","276","__extends","this","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","element","options","bindings","result","FollowItem","ID","ComponentOptions","initComponentOptions","Assert","exists","container","$$","text","icon","buildIcon","loadingIcon","buildLoadingIcon","append","el","on","toggleFollow","setAttribute","bind","KeyboardUtils","keypressAction","KEYBOARD","ENTER","onRootElement","SearchAlertsEvents","searchAlertsDeleted","args","handleSubscriptionDeleted","searchAlertsCreated","handleSubscriptionCreated","addClass","updateIsFollowed","_this","setFollowed","subscription","removeClass","l","setNotFollowed","buildFollowRequest","getId","title","hasClass","id","logAnalyticsEvent","analyticsActionCauseList","searchAlertsUnfollowDocument","queryController","getEndpoint","deleteSubscription","then","eventArgs","dom","root","trigger","catch","searchAlertsFail","searchAlertsFollowDocument","follow","getText","listSubscriptions","subscriptions","_","isArray","find","typeConfig","remove","className","SVGIcons","icons","dropdownFollowQuery","SVGDom","addClassToSVGInContainer","loading","type","parentElement","removeChild","Utils","getFieldValue","typeCofig","modifiedDateField","watchedFields","name","usageAnalytics","logCustomEvent","author","QueryUtils","getAuthor","documentLanguage","getLanguage","documentSource","getSource","documentTitle","contentIDValue","getPermanentId","fieldValue","contentIDKey","fieldUsed","doExport","exportGlobally","buildFieldsOption","buildStringOption","Component","Initialization","registerAutoCreateComponent"],"mappings":"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","file":"FollowItem.min__45edc409d97327d59af1.js","sourcesContent":["webpackJsonpCoveo__temporary([52],{\n\n/***/ 226:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SUBSCRIPTION_TYPE = {\n    followQuery: 'followQuery',\n    followDocument: 'followDocument'\n};\n\n\n/***/ }),\n\n/***/ 276:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _ = __webpack_require__(0);\nvar SearchAlertEvents_1 = __webpack_require__(83);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Assert_1 = __webpack_require__(5);\nvar Subscription_1 = __webpack_require__(226);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar KeyboardUtils_1 = __webpack_require__(25);\nvar QueryUtils_1 = __webpack_require__(21);\nvar SVGDom_1 = __webpack_require__(16);\nvar SVGIcons_1 = __webpack_require__(12);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\n/**\n * The FollowItem component renders a widget that the end user can click to follow a particular item. A user following\n * an item receives email notifications when the item changes.\n *\n * **Note:**\n * > A {@link SearchAlerts} component must be present in the page for this component to work. It is also necessary to\n * > meet certain requirements to be able to use this component (see\n * > [Deploying Search Alerts on a Coveo JS Search Page](https://docs.coveo.com/en/1932/)).\n *\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\n */\nvar FollowItem = /** @class */ (function (_super) {\n    __extends(FollowItem, _super);\n    /**\n     * Creates a new FollowItem component.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the FollowItem component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time)\n     * @param result The result to associate the component with.\n     */\n    function FollowItem(element, options, bindings, result) {\n        var _this = _super.call(this, element, FollowItem.ID, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.bindings = bindings;\n        _this.result = result;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, FollowItem, options);\n        Assert_1.Assert.exists(_this.result);\n        _this.container = Dom_1.$$(_this.element);\n        _this.text = Dom_1.$$('span');\n        var icon = _this.buildIcon();\n        var loadingIcon = _this.buildLoadingIcon();\n        _this.container.append(icon);\n        _this.container.append(loadingIcon);\n        _this.container.append(_this.text.el);\n        _this.container.on('click', function () { return _this.toggleFollow(); });\n        _this.container.setAttribute('tabindex', '0');\n        _this.bind.on(_this.container, 'keyup', KeyboardUtils_1.KeyboardUtils.keypressAction(KeyboardUtils_1.KEYBOARD.ENTER, function () { return _this.toggleFollow(); }));\n        _this.bind.onRootElement(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsDeleted, function (args) { return _this.handleSubscriptionDeleted(args); });\n        _this.bind.onRootElement(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsCreated, function (args) { return _this.handleSubscriptionCreated(args); });\n        _this.container.addClass('coveo-follow-item-loading');\n        _this.updateIsFollowed();\n        return _this;\n    }\n    FollowItem.prototype.setFollowed = function (subscription) {\n        this.container.removeClass('coveo-follow-item-loading');\n        this.subscription = subscription;\n        this.container.addClass('coveo-follow-item-followed');\n        this.text.text(Strings_1.l('SearchAlerts_unFollowing'));\n    };\n    FollowItem.prototype.setNotFollowed = function () {\n        this.container.removeClass('coveo-follow-item-loading');\n        this.subscription = FollowItem.buildFollowRequest(this.getId(), this.result.title, this.options);\n        this.container.removeClass('coveo-follow-item-followed');\n        this.text.text(Strings_1.l('SearchAlerts_follow'));\n    };\n    /**\n     * Follows the item if not already following it. Stops following the item otherwise.\n     *\n     * Also logs the appropriate event in the usage analytics (either `searchAlertsFollowDocument` or\n     * `searchAlertsUnfollowDocument`).\n     */\n    FollowItem.prototype.toggleFollow = function () {\n        var _this = this;\n        if (!this.container.hasClass('coveo-follow-item-loading')) {\n            this.container.removeClass('coveo-follow-item-followed');\n            this.container.addClass('coveo-follow-item-loading');\n            if (this.subscription.id) {\n                this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.searchAlertsUnfollowDocument);\n                this.queryController\n                    .getEndpoint()\n                    .deleteSubscription(this.subscription)\n                    .then(function () {\n                    var eventArgs = {\n                        subscription: _this.subscription,\n                        dom: _this.element\n                    };\n                    Dom_1.$$(_this.root).trigger(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsDeleted, eventArgs);\n                })\n                    .catch(function () {\n                    _this.container.removeClass('coveo-follow-item-loading');\n                    var eventArgs = {\n                        dom: _this.element\n                    };\n                    Dom_1.$$(_this.root).trigger(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsFail, eventArgs);\n                });\n            }\n            else {\n                this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.searchAlertsFollowDocument);\n                this.queryController\n                    .getEndpoint()\n                    .follow(this.subscription)\n                    .then(function (subscription) {\n                    var eventArgs = {\n                        subscription: subscription,\n                        dom: _this.element\n                    };\n                    Dom_1.$$(_this.root).trigger(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsCreated, eventArgs);\n                })\n                    .catch(function () {\n                    _this.container.removeClass('coveo-follow-item-loading');\n                    var eventArgs = {\n                        dom: _this.element\n                    };\n                    Dom_1.$$(_this.root).trigger(SearchAlertEvents_1.SearchAlertsEvents.searchAlertsFail, eventArgs);\n                });\n            }\n        }\n    };\n    FollowItem.prototype.getText = function () {\n        return this.text.text();\n    };\n    FollowItem.prototype.updateIsFollowed = function () {\n        var _this = this;\n        this.queryController\n            .getEndpoint()\n            .listSubscriptions()\n            .then(function (subscriptions) {\n            if (_.isArray(subscriptions)) {\n                var subscription = _.find(subscriptions, function (subscription) {\n                    var typeConfig = subscription.typeConfig;\n                    return typeConfig && typeConfig.id != null && typeConfig.id == _this.getId();\n                });\n                if (subscription != null) {\n                    _this.setFollowed(subscription);\n                }\n                else {\n                    _this.setNotFollowed();\n                }\n            }\n            else {\n                _this.remove();\n            }\n        })\n            .catch(function () {\n            _this.remove();\n        });\n    };\n    FollowItem.prototype.buildIcon = function () {\n        var icon = Dom_1.$$('span', { className: 'coveo-follow-item-icon' }, SVGIcons_1.SVGIcons.icons.dropdownFollowQuery);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(icon.el, 'coveo-follow-item-icon-svg');\n        return icon.el;\n    };\n    FollowItem.prototype.buildLoadingIcon = function () {\n        var loadingIcon = Dom_1.$$('span', { className: 'coveo-follow-item-icon-loading' }, SVGIcons_1.SVGIcons.icons.loading);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(loadingIcon.el, 'coveo-follow-item-icon-loading-svg');\n        return loadingIcon.el;\n    };\n    FollowItem.prototype.handleSubscriptionDeleted = function (args) {\n        if (args.subscription && args.subscription.type == Subscription_1.SUBSCRIPTION_TYPE.followDocument) {\n            var typeConfig = args.subscription.typeConfig;\n            if (typeConfig.id == this.getId()) {\n                this.setNotFollowed();\n            }\n        }\n    };\n    FollowItem.prototype.handleSubscriptionCreated = function (args) {\n        if (args.subscription && args.subscription.type == Subscription_1.SUBSCRIPTION_TYPE.followDocument) {\n            var typeConfig = args.subscription.typeConfig;\n            if (typeConfig.id == this.getId()) {\n                this.setFollowed(args.subscription);\n            }\n        }\n    };\n    FollowItem.prototype.remove = function () {\n        this.element.parentElement && this.element.parentElement.removeChild(this.element);\n    };\n    FollowItem.prototype.getId = function () {\n        return Utils_1.Utils.getFieldValue(this.result, 'sysurihash') || Utils_1.Utils.getFieldValue(this.result, 'urihash');\n    };\n    FollowItem.buildFollowRequest = function (id, title, options) {\n        var typeCofig = {\n            id: id,\n            title: title\n        };\n        if (options.modifiedDateField) {\n            typeCofig.modifiedDateField = options.modifiedDateField;\n        }\n        if (options.watchedFields) {\n            typeCofig.watchedFields = options.watchedFields;\n        }\n        return {\n            type: Subscription_1.SUBSCRIPTION_TYPE.followDocument,\n            typeConfig: typeCofig,\n            name: title\n        };\n    };\n    FollowItem.prototype.logAnalyticsEvent = function (type) {\n        this.usageAnalytics.logCustomEvent(type, {\n            author: QueryUtils_1.QueryUtils.getAuthor(this.result),\n            documentLanguage: QueryUtils_1.QueryUtils.getLanguage(this.result),\n            documentSource: QueryUtils_1.QueryUtils.getSource(this.result),\n            documentTitle: this.result.title,\n            contentIDValue: QueryUtils_1.QueryUtils.getPermanentId(this.result).fieldValue,\n            contentIDKey: QueryUtils_1.QueryUtils.getPermanentId(this.result).fieldUsed\n        }, this.element);\n    };\n    FollowItem.ID = 'FollowItem';\n    FollowItem.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            FollowItem: FollowItem\n        });\n    };\n    /**\n     * The options for the follow item component\n     * @componentOptions\n     */\n    FollowItem.options = {\n        /**\n         * Specifies the {@link ISubscriptionItemRequest.watchedFields} to use when sending the\n         * {@link ISubscriptionItemRequest}.\n         *\n         * Default value is `undefined`.\n         */\n        watchedFields: ComponentOptions_1.ComponentOptions.buildFieldsOption(),\n        /**\n         * Specifies the {@link ISubscriptionItemRequest.modifiedDateField} to use when sending the\n         * {@link ISubscriptionItemRequest}.\n         *\n         * Default value is `undefined`.\n         */\n        modifiedDateField: ComponentOptions_1.ComponentOptions.buildStringOption()\n    };\n    return FollowItem;\n}(Component_1.Component));\nexports.FollowItem = FollowItem;\nInitialization_1.Initialization.registerAutoCreateComponent(FollowItem);\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// FollowItem.min__45edc409d97327d59af1.js","import { IQuery } from './Query';\n\nexport const SUBSCRIPTION_TYPE = {\n  followQuery: 'followQuery',\n  followDocument: 'followDocument'\n};\n\nexport interface ISearchAlertsEndpointOptions {\n  restUri: string;\n  accessToken?: string;\n  errorsAsSuccess?: boolean;\n}\n\nexport interface ISearchAlertsEndpointCallOptions {\n  type?: string;\n  page?: number;\n}\n\nexport interface ISearchAlertsEndpointSearchCallOptions {\n  documentIds: string[];\n}\n\n/**\n * Describe a subscription to the Coveo Search alerts service\n */\nexport interface ISubscription extends ISubscriptionRequest {\n  /**\n   * The id of the subscription\n   */\n  id: string;\n\n  /**\n   * The user associated with the subscription\n   */\n  user: ISubscriptionUser;\n}\n\n/**\n * Describe a user associated with a subscription to the Coveo Search alerts service\n */\nexport interface ISubscriptionUser {\n  /**\n   * The email of the user\n   */\n  email: string;\n\n  /**\n   * The token used to manage the alerts via email.\n   */\n  manageToken: string;\n}\n\n/**\n * Describe a request to subscribe to the Coveo Search alerts service\n */\nexport interface ISubscriptionRequest {\n  /**\n   * Type of subscription.<br/>\n   * Can be 'followQuery' or 'followDocument'\n   */\n  type: string;\n  /**\n   * Config of the subscription\n   */\n  typeConfig: ISubscriptionQueryRequest | ISubscriptionItemRequest;\n  /**\n   * Frequency of the alerts\n   */\n  frequency?: string;\n  /**\n   * The name that should be used by the API to identify this subscription\n   */\n  name: string;\n}\n\n/**\n * Describe a subscription to a single query\n */\nexport interface ISubscriptionQueryRequest {\n  /**\n   * Query to subscribe to\n   */\n  query: IQuery;\n  /**\n   * Which field on the result set represent the modification date for which you wish to receive alerts\n   */\n  modifiedDateField?: string;\n}\n\n/**\n * The `ISubscriptionItemRequest` interface describes a subscription to a single item (a result).\n */\nexport interface ISubscriptionItemRequest {\n  /**\n   * Contains the unique ID of the item to subscribe to.\n   */\n  id: string;\n\n  /**\n   * Contains the title of the item to subscribe to.\n   */\n  title: string;\n\n  /**\n   * Indicates which field contains the modification date of the item to subscribe to.\n   */\n  modifiedDateField?: string;\n\n  /**\n   * Contains a list of fields to monitor for the item to subscribe to.\n   */\n  watchedFields?: string[];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest/Subscription.ts","import * as _ from 'underscore';\nimport { ISearchAlertsEventArgs, ISearchAlertsFailEventArgs, SearchAlertsEvents } from '../../events/SearchAlertEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Assert } from '../../misc/Assert';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { ISubscription, ISubscriptionItemRequest, ISubscriptionRequest, SUBSCRIPTION_TYPE } from '../../rest/Subscription';\nimport { l } from '../../strings/Strings';\nimport { $$, Dom } from '../../utils/Dom';\nimport { KEYBOARD, KeyboardUtils } from '../../utils/KeyboardUtils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { Utils } from '../../utils/Utils';\nimport {\n  analyticsActionCauseList,\n  IAnalyticsActionCause,\n  IAnalyticsSearchAlertsFollowDocumentMeta\n} from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IFieldOption } from '../Base/IComponentOptions';\nimport { Initialization } from '../Base/Initialization';\nimport { IResultsComponentBindings } from '../Base/ResultsComponentBindings';\n\nexport interface IFollowItemOptions {\n  watchedFields?: IFieldOption[];\n  modifiedDateField?: string;\n}\n\n/**\n * The FollowItem component renders a widget that the end user can click to follow a particular item. A user following\n * an item receives email notifications when the item changes.\n *\n * **Note:**\n * > A {@link SearchAlerts} component must be present in the page for this component to work. It is also necessary to\n * > meet certain requirements to be able to use this component (see\n * > [Deploying Search Alerts on a Coveo JS Search Page](https://docs.coveo.com/en/1932/)).\n *\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\n */\nexport class FollowItem extends Component {\n  static ID = 'FollowItem';\n\n  static doExport = () => {\n    exportGlobally({\n      FollowItem: FollowItem\n    });\n  };\n\n  /**\n   * The options for the follow item component\n   * @componentOptions\n   */\n  static options: IFollowItemOptions = {\n    /**\n     * Specifies the {@link ISubscriptionItemRequest.watchedFields} to use when sending the\n     * {@link ISubscriptionItemRequest}.\n     *\n     * Default value is `undefined`.\n     */\n    watchedFields: ComponentOptions.buildFieldsOption(),\n\n    /**\n     * Specifies the {@link ISubscriptionItemRequest.modifiedDateField} to use when sending the\n     * {@link ISubscriptionItemRequest}.\n     *\n     * Default value is `undefined`.\n     */\n    modifiedDateField: ComponentOptions.buildStringOption()\n  };\n\n  private container: Dom;\n  private text: Dom;\n  private subscription: ISubscription;\n\n  /**\n   * Creates a new FollowItem component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the FollowItem component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time)\n   * @param result The result to associate the component with.\n   */\n  constructor(\n    public element: HTMLElement,\n    public options?: IFollowItemOptions,\n    public bindings?: IResultsComponentBindings,\n    public result?: IQueryResult\n  ) {\n    super(element, FollowItem.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, FollowItem, options);\n\n    Assert.exists(this.result);\n\n    this.container = $$(this.element);\n    this.text = $$('span');\n    const icon = this.buildIcon();\n    const loadingIcon = this.buildLoadingIcon();\n    this.container.append(icon);\n    this.container.append(loadingIcon);\n    this.container.append(this.text.el);\n    this.container.on('click', () => this.toggleFollow());\n    this.container.setAttribute('tabindex', '0');\n    this.bind.on(this.container, 'keyup', KeyboardUtils.keypressAction(KEYBOARD.ENTER, () => this.toggleFollow()));\n\n    this.bind.onRootElement(SearchAlertsEvents.searchAlertsDeleted, (args: ISearchAlertsEventArgs) => this.handleSubscriptionDeleted(args));\n    this.bind.onRootElement(SearchAlertsEvents.searchAlertsCreated, (args: ISearchAlertsEventArgs) => this.handleSubscriptionCreated(args));\n\n    this.container.addClass('coveo-follow-item-loading');\n\n    this.updateIsFollowed();\n  }\n\n  public setFollowed(subscription: ISubscription) {\n    this.container.removeClass('coveo-follow-item-loading');\n    this.subscription = subscription;\n    this.container.addClass('coveo-follow-item-followed');\n    this.text.text(l('SearchAlerts_unFollowing'));\n  }\n\n  public setNotFollowed() {\n    this.container.removeClass('coveo-follow-item-loading');\n    this.subscription = <ISubscription>FollowItem.buildFollowRequest(this.getId(), this.result.title, this.options);\n    this.container.removeClass('coveo-follow-item-followed');\n    this.text.text(l('SearchAlerts_follow'));\n  }\n\n  /**\n   * Follows the item if not already following it. Stops following the item otherwise.\n   *\n   * Also logs the appropriate event in the usage analytics (either `searchAlertsFollowDocument` or\n   * `searchAlertsUnfollowDocument`).\n   */\n  public toggleFollow() {\n    if (!this.container.hasClass('coveo-follow-item-loading')) {\n      this.container.removeClass('coveo-follow-item-followed');\n      this.container.addClass('coveo-follow-item-loading');\n      if (this.subscription.id) {\n        this.logAnalyticsEvent(analyticsActionCauseList.searchAlertsUnfollowDocument);\n        this.queryController\n          .getEndpoint()\n          .deleteSubscription(this.subscription)\n          .then(() => {\n            const eventArgs: ISearchAlertsEventArgs = {\n              subscription: this.subscription,\n              dom: this.element\n            };\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsDeleted, eventArgs);\n          })\n          .catch(() => {\n            this.container.removeClass('coveo-follow-item-loading');\n            const eventArgs: ISearchAlertsFailEventArgs = {\n              dom: this.element\n            };\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsFail, eventArgs);\n          });\n      } else {\n        this.logAnalyticsEvent(analyticsActionCauseList.searchAlertsFollowDocument);\n        this.queryController\n          .getEndpoint()\n          .follow(this.subscription)\n          .then((subscription: ISubscription) => {\n            const eventArgs: ISearchAlertsEventArgs = {\n              subscription: subscription,\n              dom: this.element\n            };\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsCreated, eventArgs);\n          })\n          .catch(() => {\n            this.container.removeClass('coveo-follow-item-loading');\n            const eventArgs: ISearchAlertsFailEventArgs = {\n              dom: this.element\n            };\n            $$(this.root).trigger(SearchAlertsEvents.searchAlertsFail, eventArgs);\n          });\n      }\n    }\n  }\n\n  protected getText(): string {\n    return this.text.text();\n  }\n\n  private updateIsFollowed() {\n    this.queryController\n      .getEndpoint()\n      .listSubscriptions()\n      .then((subscriptions: ISubscription[]) => {\n        if (_.isArray(subscriptions)) {\n          const subscription: ISubscription = _.find(subscriptions, (subscription: ISubscription) => {\n            const typeConfig = <ISubscriptionItemRequest>subscription.typeConfig;\n            return typeConfig && typeConfig.id != null && typeConfig.id == this.getId();\n          });\n          if (subscription != null) {\n            this.setFollowed(subscription);\n          } else {\n            this.setNotFollowed();\n          }\n        } else {\n          this.remove();\n        }\n      })\n      .catch(() => {\n        this.remove();\n      });\n  }\n  private buildIcon(): HTMLElement {\n    const icon = $$('span', { className: 'coveo-follow-item-icon' }, SVGIcons.icons.dropdownFollowQuery);\n    SVGDom.addClassToSVGInContainer(icon.el, 'coveo-follow-item-icon-svg');\n    return icon.el;\n  }\n\n  private buildLoadingIcon(): HTMLElement {\n    const loadingIcon = $$('span', { className: 'coveo-follow-item-icon-loading' }, SVGIcons.icons.loading);\n    SVGDom.addClassToSVGInContainer(loadingIcon.el, 'coveo-follow-item-icon-loading-svg');\n    return loadingIcon.el;\n  }\n\n  private handleSubscriptionDeleted(args: ISearchAlertsEventArgs) {\n    if (args.subscription && args.subscription.type == SUBSCRIPTION_TYPE.followDocument) {\n      const typeConfig = <ISubscriptionItemRequest>args.subscription.typeConfig;\n      if (typeConfig.id == this.getId()) {\n        this.setNotFollowed();\n      }\n    }\n  }\n\n  private handleSubscriptionCreated(args: ISearchAlertsEventArgs) {\n    if (args.subscription && args.subscription.type == SUBSCRIPTION_TYPE.followDocument) {\n      const typeConfig = <ISubscriptionItemRequest>args.subscription.typeConfig;\n      if (typeConfig.id == this.getId()) {\n        this.setFollowed(args.subscription);\n      }\n    }\n  }\n\n  private remove() {\n    this.element.parentElement && this.element.parentElement.removeChild(this.element);\n  }\n\n  private getId() {\n    return Utils.getFieldValue(this.result, 'sysurihash') || Utils.getFieldValue(this.result, 'urihash');\n  }\n\n  private static buildFollowRequest(id: string, title: string, options: IFollowItemOptions): ISubscriptionRequest {\n    const typeCofig: ISubscriptionItemRequest = {\n      id: id,\n      title: title\n    };\n\n    if (options.modifiedDateField) {\n      typeCofig.modifiedDateField = options.modifiedDateField;\n    }\n\n    if (options.watchedFields) {\n      typeCofig.watchedFields = <string[]>options.watchedFields;\n    }\n\n    return {\n      type: SUBSCRIPTION_TYPE.followDocument,\n      typeConfig: typeCofig,\n      name: title\n    };\n  }\n\n  private logAnalyticsEvent(type: IAnalyticsActionCause) {\n    this.usageAnalytics.logCustomEvent<IAnalyticsSearchAlertsFollowDocumentMeta>(\n      type,\n      {\n        author: QueryUtils.getAuthor(this.result),\n        documentLanguage: QueryUtils.getLanguage(this.result),\n        documentSource: QueryUtils.getSource(this.result),\n        documentTitle: this.result.title,\n        contentIDValue: QueryUtils.getPermanentId(this.result).fieldValue,\n        contentIDKey: QueryUtils.getPermanentId(this.result).fieldUsed\n      },\n      this.element\n    );\n  }\n}\n\nInitialization.registerAutoCreateComponent(FollowItem);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FollowItem/FollowItem.ts"],"sourceRoot":""}