{"version":3,"sources":["Matrix.min__45edc409d97327d59af1.js","./src/ui/Matrix/Matrix.ts","./src/ui/Matrix/Cell.ts","./src/ui/Matrix/DefaultMatrixResultPreviewTemplate.ts"],"names":["webpackJsonpCoveo__temporary","258","module","exports","__webpack_require__","__extends","this","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","value","element","options","bindings","Matrix","ID","groupByIndex","rowId","columnId","selectedRowValue","undefined","selectedColumnValue","numberOfRows","numberOfColumns","ComponentOptions","initComponentOptions","previewTemplate","DefaultMatrixResultPreviewTemplate","computedField","computedFieldFormat","previewSortField","columnFieldValues","length","columnLabels","buildMatrix","rowField","logger","error","columnField","bindEvents","initQueryState","_this","selectCell","rowNumber","columnNumber","rowValue","columnValue","getRowValue","getColumnValue","isRowFacetPresent","queryStateModel","set","isColumnFacetPresent","getSelectedColumnValue","getSelectedRowValue","getCellElement","data","getHTML","getCellValue","cell","$$","text","drawMatrix","headerRow","className","drawRow","el","numberOfRowsToDraw","enableColumnTotals","i","row","totalRow","cellFontSize","cells","findAll","_","each","c","style","fontSize","bind","onRootElement","QueryEvents","buildingQuery","args","handleBuildingQuery","doneBuildingQuery","handleDoneBuildingQuery","deferredQuerySuccess","handleDeferredQuerySuccess","QueryStateModel","getFacetId","registerNewAttribute","buildTitle","buildBody","addHeaderRow","title","titleHtml","appendChild","body","areFacetsPresent","queryBuilder","advancedExpression","addFieldExpression","addMainGroubByRequest","addColumnsGroupByRequests","reset","parseResults","results","addTotals","formatCells","groupBy","field","sortCriteria","computedFields","getComputedFields","maximumNumberOfValues","maximumNumberOfRows","push","groupByRequests","queryOverride","buildExpression","maximumNumberOfValuesInGroupBy","expression","build","constantExpression","totalQuery","operation","computedFieldOperation","getCellResult","cellResult","values","computedFieldResults","isAColumnSelected","isColumnSelected","enableRowTotals","addRowTotals","addColumnTotals","addColumn","setValue","rowTotal","computeRowTotal","toLowerCase","sort","a","getValue","addRow","columnTotal","computeColumnTotal","total","parseInt","j","cellValue","Globalize","format","columnHeader","addCellToRow","column","addClass","Cell","Utils","isNullOrUndefined","toString","isCellSelected","handleClick","queryController","executeQuery","get","selectedColumnValues","attributes","isARowSelected","isRowSelected","selectedRowValues","facet","componentStateModel","disabled","empty","mainResults","groupByResults","columnResult","find","this_1","on","num","enableHoverPreview","handleHoverIn","handleHoverOut","isHoverWorkingOnRow","isHoverWorkingOnColumn","previewTimeout","window","setTimeout","displayResultsPreview","previewDelay","clearTimeout","removePreview","query","createPreviewQuery","addPreview","previewMinWidth","previewMaxWidth","getEndpoint","search","then","isDataAvailable","instantiatedResults","map","r","instantiateTemplate","html","result","builtResultElement","outerHTML","Promise","all","updatePreview","instantiateToElement","checkCondition","responsiveComponents","searchInterface","content","initParameters","getBindings","Initialization","automaticallyCreateComponentsInside","initResult","rowFieldExpression","QueryUtils","buildFieldExpression","columnFieldExpression","getLastQuery","aq","previewSortCriteria","sortField","fieldSliced","slice","fieldsToInclude","doExport","exportGlobally","buildStringOption","buildFieldOption","required","defaultValue","buildNumberOption","min","buildBooleanOption","buildListOption","TemplateComponentOptions","buildTemplateOption","Component","registerAutoCreateComponent","627","628","previewActive","setHTML","minWidth","maxWidth","previewContainer","e","stopPropagation","container","hide","detach","template","preview","innerHTML","show","629","instantiateToString","object","instantiateOptions","raw","resolve","reject","Template"],"mappings":"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","file":"Matrix.min__45edc409d97327d59af1.js","sourcesContent":["webpackJsonpCoveo__temporary([36],{\n\n/***/ 258:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Globalize = __webpack_require__(23);\n__webpack_require__(627);\nvar _ = __webpack_require__(0);\nvar QueryEvents_1 = __webpack_require__(11);\nvar GlobalExports_1 = __webpack_require__(3);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar Dom_1 = __webpack_require__(1);\nvar QueryUtils_1 = __webpack_require__(21);\nvar Utils_1 = __webpack_require__(4);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\nvar TemplateComponentOptions_1 = __webpack_require__(61);\nvar Cell_1 = __webpack_require__(628);\nvar DefaultMatrixResultPreviewTemplate_1 = __webpack_require__(629);\n/**\n * The Matrix component uses the values of two fields (row and column) to display the results of the specified computed\n * field in a table.\n *\n * The user specifies the values to use for the columns. An {@link IGroupByRequest} operation performed at the same time\n * as the main query retrieves the values to use for the rows.\n *\n * In a way that is similar to the {@link Facet} component, selecting a Matrix cell allows the end user to drill down\n * inside the results by restricting the row field and the column field to match the values of the selected cell.\n *\n * @notSupportedIn salesforcefree\n */\nvar Matrix = /** @class */ (function (_super) {\n    __extends(Matrix, _super);\n    /**\n     * Creates a new Matrix. Also verifies whether options are valid and coherent. Binds query events.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the Matrix component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     */\n    function Matrix(element, options, bindings) {\n        var _this = _super.call(this, element, Matrix.ID, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.groupByIndex = [];\n        _this.rowId = '';\n        _this.columnId = '';\n        /**\n         * The currently selected row value, or `undefined` if nothing is selected.\n         */\n        _this.selectedRowValue = undefined;\n        /**\n         * The currently selected column value, or `undefined` if nothing is selected.\n         */\n        _this.selectedColumnValue = undefined;\n        _this.numberOfRows = 0;\n        _this.numberOfColumns = 0;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, Matrix, options);\n        if (!_this.options.previewTemplate) {\n            _this.options.previewTemplate = new DefaultMatrixResultPreviewTemplate_1.DefaultMatrixResultPreviewTemplate(_this.options.computedField, _this.options.computedFieldFormat);\n        }\n        if (!_this.options.previewSortField) {\n            _this.options.previewSortField = _this.options.computedField;\n        }\n        if (_this.options.columnFieldValues.length != _this.options.columnLabels.length) {\n            _this.options.columnLabels = _this.options.columnFieldValues;\n        }\n        _this.buildMatrix();\n        if (_this.options.rowField == null) {\n            _this.logger.error(\"'rowField' option is required in the Matrix component\");\n        }\n        else if (_this.options.columnField == null) {\n            _this.logger.error(\"'columnField' option is required in the Matrix component\");\n        }\n        else if (_this.options.computedField == null) {\n            _this.logger.error(\"'computedField' option is required in the Matrix component\");\n        }\n        else {\n            _this.bindEvents();\n            _this.initQueryState();\n        }\n        return _this;\n    }\n    /**\n     * Selects a cell by its row and column number. Does not execute a query.\n     * @param rowNumber The row number of the cell to select.\n     * @param columnNumber The column number of the cell to select.\n     */\n    Matrix.prototype.selectCell = function (rowNumber, columnNumber) {\n        var rowValue, columnValue;\n        if (rowNumber !== 0 && rowNumber !== this.numberOfRows - 1) {\n            rowValue = this.getRowValue(rowNumber);\n        }\n        if (columnNumber !== 0 && columnNumber !== this.numberOfColumns - 1) {\n            columnValue = this.getColumnValue(columnNumber);\n        }\n        if (rowValue && this.isRowFacetPresent()) {\n            this.queryStateModel.set(this.rowId, [rowValue]);\n        }\n        else {\n            this.selectedRowValue = rowValue;\n            this.queryStateModel.set(this.rowId, []);\n        }\n        if (columnValue && this.isColumnFacetPresent()) {\n            this.queryStateModel.set(this.columnId, [columnValue]);\n        }\n        else {\n            this.selectedColumnValue = columnValue;\n            this.queryStateModel.set(this.columnId, []);\n        }\n    };\n    /**\n     * Returns the currently selected column value.\n     */\n    Matrix.prototype.getSelectedColumnValue = function () {\n        return this.selectedColumnValue;\n    };\n    /**\n     * Returns the currently selected row value.\n     */\n    Matrix.prototype.getSelectedRowValue = function () {\n        return this.selectedRowValue;\n    };\n    /**\n     * Gets the HTMLElement associated to a cell.\n     * @param rowNumber The row number of the cell.\n     * @param columnNumber The column number of the cell.\n     * @returns {HTMLElement} The associated HTMLElement.\n     */\n    Matrix.prototype.getCellElement = function (rowNumber, columnNumber) {\n        return this.data[rowNumber][columnNumber].getHTML();\n    };\n    /**\n     * Gets the string associated to a cell.\n     * @param rowNumber The row number of the cell.\n     * @param columnNumber The column number of the cell.\n     * @returns {string} The associated string.\n     */\n    Matrix.prototype.getCellValue = function (rowNumber, columnNumber) {\n        var cell = this.getCellElement(rowNumber, columnNumber);\n        return Dom_1.$$(cell).text();\n    };\n    Matrix.prototype.drawMatrix = function () {\n        var _this = this;\n        var headerRow = Dom_1.$$('div', {\n            className: 'coveo-matrix-row matrix-header-row'\n        });\n        this.drawRow(headerRow.el, 0);\n        var numberOfRowsToDraw = this.options.enableColumnTotals ? this.numberOfRows - 1 : this.numberOfRows;\n        for (var i = 1; i < numberOfRowsToDraw; i++) {\n            var row = Dom_1.$$('div', {\n                className: 'coveo-matrix-row'\n            }).el;\n            this.drawRow(row, i);\n        }\n        if (this.options.enableColumnTotals) {\n            var totalRow = Dom_1.$$('div', {\n                className: 'coveo-matrix-row matrix-total-row'\n            }).el;\n            this.drawRow(totalRow, this.numberOfRows - 1);\n        }\n        if (this.options.cellFontSize !== '') {\n            var cells = Dom_1.$$(this.element).findAll('.coveo-matrix-cell');\n            _.each(cells, function (c) {\n                c.style.fontSize = _this.options.cellFontSize;\n            });\n        }\n    };\n    Matrix.prototype.bindEvents = function () {\n        var _this = this;\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.doneBuildingQuery, function (args) { return _this.handleDoneBuildingQuery(args); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function (args) { return _this.handleDeferredQuerySuccess(args); });\n    };\n    Matrix.prototype.initQueryState = function () {\n        this.rowId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.rowField);\n        this.columnId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.columnField);\n        this.queryStateModel.registerNewAttribute(this.rowId, []);\n        this.queryStateModel.registerNewAttribute(this.columnId, []);\n    };\n    Matrix.prototype.buildMatrix = function () {\n        this.buildTitle();\n        this.buildBody();\n        this.data = new Array();\n        this.addHeaderRow();\n    };\n    Matrix.prototype.buildTitle = function () {\n        var title = this.options.title ? this.options.title : '';\n        var titleHtml = Dom_1.$$('div', {\n            className: 'coveo-matrix-title'\n        }, title).el;\n        this.element.appendChild(titleHtml);\n    };\n    Matrix.prototype.buildBody = function () {\n        var body = Dom_1.$$('div', {\n            className: 'coveo-matrix'\n        }).el;\n        this.element.appendChild(body);\n    };\n    Matrix.prototype.handleBuildingQuery = function (args) {\n        if (!this.areFacetsPresent()) {\n            if (this.selectedRowValue && !this.isRowFacetPresent()) {\n                args.queryBuilder.advancedExpression.addFieldExpression(this.options.rowField, '=', [this.selectedRowValue]);\n            }\n            if (this.selectedColumnValue && !this.isColumnFacetPresent()) {\n                args.queryBuilder.advancedExpression.addFieldExpression(this.options.columnField, '=', [this.selectedColumnValue]);\n            }\n        }\n    };\n    Matrix.prototype.handleDoneBuildingQuery = function (args) {\n        this.groupByIndex = [];\n        this.addMainGroubByRequest(args.queryBuilder);\n        this.addColumnsGroupByRequests(args.queryBuilder);\n    };\n    Matrix.prototype.handleDeferredQuerySuccess = function (args) {\n        this.reset();\n        this.parseResults(args.results);\n        this.addTotals();\n        this.drawMatrix();\n        this.formatCells();\n        this.selectedRowValue = undefined;\n        this.selectedColumnValue = undefined;\n    };\n    Matrix.prototype.addMainGroubByRequest = function (queryBuilder) {\n        var groupBy = {\n            field: this.options.rowField,\n            sortCriteria: this.options.sortCriteria,\n            computedFields: this.getComputedFields(),\n            maximumNumberOfValues: this.options.maximumNumberOfRows\n        };\n        this.groupByIndex.push(queryBuilder.groupByRequests.length);\n        queryBuilder.groupByRequests.push(groupBy);\n    };\n    Matrix.prototype.addColumnsGroupByRequests = function (queryBuilder) {\n        for (var i = 0; i < this.options.columnFieldValues.length; i++) {\n            var groupBy = {\n                field: this.options.rowField,\n                sortCriteria: this.options.sortCriteria,\n                computedFields: this.getComputedFields(),\n                queryOverride: '(' + this.buildExpression(queryBuilder) + ')' + '(' + this.options.columnField + \"='\" + this.options.columnFieldValues[i] + \"')\",\n                maximumNumberOfValues: this.options.maximumNumberOfValuesInGroupBy\n            };\n            this.groupByIndex.push(queryBuilder.groupByRequests.length);\n            queryBuilder.groupByRequests.push(groupBy);\n        }\n    };\n    Matrix.prototype.buildExpression = function (queryBuilder) {\n        var expression = queryBuilder.expression.build();\n        var advancedExpression = queryBuilder.advancedExpression.build();\n        var constantExpression = queryBuilder.constantExpression.build();\n        var totalQuery = '';\n        if (expression) {\n            totalQuery += ' ' + expression;\n        }\n        if (advancedExpression) {\n            totalQuery += ' ' + advancedExpression;\n        }\n        if (constantExpression) {\n            totalQuery += ' ' + constantExpression;\n        }\n        return totalQuery;\n    };\n    Matrix.prototype.getComputedFields = function () {\n        var computedFields = [\n            {\n                field: this.options.computedField,\n                operation: this.options.computedFieldOperation\n            }\n        ];\n        return computedFields;\n    };\n    Matrix.prototype.getCellResult = function (results, rowNumber, columnNumber) {\n        var rowValue = this.getRowValue(rowNumber);\n        var columnValue = this.getColumnValue(columnNumber);\n        var cellResult = 0;\n        for (var i = 0; i < results.values.length; i++) {\n            if (results.values[i].value === rowValue) {\n                cellResult = results.values[i].computedFieldResults[0];\n                break;\n            }\n        }\n        if (this.isAColumnSelected() && !this.isColumnSelected(columnValue)) {\n            cellResult = 0;\n        }\n        return cellResult;\n    };\n    Matrix.prototype.addTotals = function () {\n        if (this.options.enableRowTotals) {\n            this.addRowTotals();\n        }\n        if (this.options.enableColumnTotals) {\n            this.addColumnTotals();\n        }\n    };\n    Matrix.prototype.addRowTotals = function () {\n        var _this = this;\n        this.addColumn();\n        this.setValue('Total', 0, this.numberOfColumns - 1);\n        for (var i = 1; i < this.numberOfRows; i++) {\n            var rowTotal = this.computeRowTotal(i);\n            this.setValue(rowTotal, i, this.numberOfColumns - 1);\n        }\n        // Fix sort ordering when not all columns field values are present.\n        if (this.options.sortCriteria.toLowerCase() == 'computedfielddescending') {\n            this.data.sort(function (a, b) {\n                return b[_this.numberOfColumns - 1].getValue() - a[_this.numberOfColumns - 1].getValue();\n            });\n        }\n        if (this.options.sortCriteria.toLowerCase() == 'computedfieldascending') {\n            this.data.sort(function (a, b) {\n                return a[_this.numberOfColumns - 1].getValue() - b[_this.numberOfColumns - 1].getValue();\n            });\n        }\n    };\n    Matrix.prototype.addColumnTotals = function () {\n        this.addRow();\n        this.setValue('Total', this.numberOfRows - 1, 0);\n        for (var i = 1; i < this.numberOfColumns; i++) {\n            var columnTotal = this.computeColumnTotal(i);\n            this.setValue(columnTotal, this.numberOfRows - 1, i);\n        }\n    };\n    Matrix.prototype.computeRowTotal = function (rowNumber) {\n        var total = 0;\n        for (var columnNumber = 1; columnNumber < this.numberOfColumns - 1; columnNumber++) {\n            total += parseInt(this.getCellValue(rowNumber, columnNumber));\n        }\n        return total;\n    };\n    Matrix.prototype.computeColumnTotal = function (columnNumber) {\n        var total = 0;\n        for (var rowNumber = 1; rowNumber < this.numberOfRows - 1; rowNumber++) {\n            total += parseInt(this.getCellValue(rowNumber, columnNumber));\n        }\n        return total;\n    };\n    Matrix.prototype.formatCells = function () {\n        for (var i = 1; i < this.numberOfRows; i++) {\n            for (var j = 1; j < this.numberOfColumns; j++) {\n                var cellValue = this.getCellValue(i, j);\n                cellValue = Globalize.format(parseInt(cellValue), this.options.computedFieldFormat);\n                this.setValue(cellValue, i, j);\n            }\n        }\n    };\n    Matrix.prototype.addHeaderRow = function () {\n        this.addRow();\n        this.addColumn();\n        this.setValue(this.options.columnHeader, 0, 0);\n        for (var i = 0; i < this.options.columnLabels.length; i++) {\n            this.addColumn();\n            this.setValue(this.options.columnLabels[i], 0, i + 1);\n        }\n    };\n    Matrix.prototype.addRow = function () {\n        this.data.push(new Array());\n        for (var i = 0; i < this.numberOfColumns; i++) {\n            this.addCellToRow(this.numberOfRows, i);\n        }\n        this.numberOfRows++;\n    };\n    Matrix.prototype.addColumn = function () {\n        for (var i = 0; i < this.numberOfRows; i++) {\n            this.addCellToRow(i, this.numberOfColumns);\n        }\n        this.numberOfColumns++;\n    };\n    Matrix.prototype.addCellToRow = function (rowNumber, columnNumber) {\n        var column = Dom_1.$$('div', {\n            className: 'coveo-matrix-cell'\n        });\n        if (columnNumber == 0) {\n            column.addClass('matrix-first-column');\n        }\n        this.data[rowNumber].push(new Cell_1.Cell(0, column.el));\n    };\n    Matrix.prototype.setValue = function (value, rowNumber, columnNumber) {\n        var cell = this.getCellElement(rowNumber, columnNumber);\n        if (!Utils_1.Utils.isNullOrUndefined(value)) {\n            Dom_1.$$(cell).text(value.toString());\n        }\n        if (this.isCellSelected(this.getRowValue(rowNumber), this.getColumnValue(columnNumber))) {\n            Dom_1.$$(cell).addClass('coveo-matrix-selected');\n        }\n        if (this.isAColumnSelected() && !this.isColumnSelected(this.getColumnValue(columnNumber))) {\n            if (columnNumber != 0 && rowNumber != 0) {\n                Dom_1.$$(cell).addClass('coveo-matrix-unimportant');\n            }\n        }\n        this.data[rowNumber][columnNumber].setValue(value);\n    };\n    Matrix.prototype.handleClick = function (rowNumber, columnNumber) {\n        this.selectCell(rowNumber, columnNumber);\n        this.queryController.executeQuery();\n    };\n    Matrix.prototype.getRowValue = function (rowNumber) {\n        return this.data[rowNumber][0].getValue();\n    };\n    Matrix.prototype.getColumnValue = function (columnNumber) {\n        return this.options.columnFieldValues[columnNumber - 1];\n    };\n    Matrix.prototype.isAColumnSelected = function () {\n        var selectedColumnValues = this.queryStateModel.get(this.columnId) || [];\n        return selectedColumnValues.length !== 0 || this.selectedColumnValue != undefined;\n    };\n    Matrix.prototype.isColumnSelected = function (columnValue) {\n        if (this.isAColumnSelected() && columnValue) {\n            var selectedColumnValues = this.queryStateModel.attributes[this.columnId] || [];\n            for (var i = 0; i < selectedColumnValues.length; i++) {\n                if (selectedColumnValues[i].toLowerCase() === columnValue.toLowerCase()) {\n                    return true;\n                }\n            }\n        }\n        return this.selectedColumnValue == columnValue;\n    };\n    Matrix.prototype.isARowSelected = function () {\n        var selectedRowValues = this.queryStateModel.get(this.rowId) || [];\n        return selectedRowValues.length !== 0 || this.selectedRowValue !== undefined;\n    };\n    Matrix.prototype.isRowSelected = function (rowValue) {\n        if (this.isARowSelected() && rowValue) {\n            var selectedRowValues = this.queryStateModel.get(this.rowId) || [];\n            for (var i = 0; i < selectedRowValues.length; i++) {\n                if (selectedRowValues[i].toLowerCase() === rowValue.toLowerCase()) {\n                    return true;\n                }\n            }\n        }\n        return this.selectedRowValue == rowValue;\n    };\n    Matrix.prototype.isCellSelected = function (rowValue, columnValue) {\n        if (this.isAColumnSelected() && this.isARowSelected()) {\n            return this.isRowSelected(rowValue) && this.isColumnSelected(columnValue);\n        }\n        else if (this.isAColumnSelected()) {\n            return this.isColumnSelected(columnValue);\n        }\n        return false;\n    };\n    Matrix.prototype.areFacetsPresent = function () {\n        return this.isRowFacetPresent() && this.isColumnFacetPresent();\n    };\n    Matrix.prototype.isRowFacetPresent = function () {\n        var facet = this.componentStateModel.get(this.rowId);\n        return facet && !facet[0].disabled;\n    };\n    Matrix.prototype.isColumnFacetPresent = function () {\n        var facet = this.componentStateModel.get(this.columnId);\n        return facet && !facet[0].disabled;\n    };\n    Matrix.prototype.reset = function () {\n        Dom_1.$$(this.element).empty();\n        this.numberOfRows = 0;\n        this.numberOfColumns = 0;\n        this.data = new Array();\n        this.buildMatrix();\n    };\n    Matrix.prototype.parseResults = function (results) {\n        if (results) {\n            var mainResults = results.groupByResults[this.groupByIndex[0]];\n            if (mainResults) {\n                for (var i = 0; i < mainResults.values.length; i++) {\n                    var value = mainResults.values[i].value;\n                    this.addRow();\n                    this.setValue(value, i + 1, 0);\n                }\n            }\n            for (var i = 1; i < this.numberOfRows; i++) {\n                for (var j = 1; j < this.numberOfColumns; j++) {\n                    var columnResult = results.groupByResults[this.groupByIndex[j]];\n                    var cellValue = this.getCellResult(columnResult, i, j);\n                    this.setValue(cellValue, i, j);\n                }\n            }\n        }\n    };\n    Matrix.prototype.drawRow = function (row, rowNumber) {\n        var _this = this;\n        var body = Dom_1.$$(this.element).find('.coveo-matrix');\n        var _loop_1 = function (i) {\n            var cell = this_1.data[rowNumber][i].getHTML();\n            Dom_1.$$(cell).on('click', function () {\n                var handler = function (num) {\n                    _this.handleClick(rowNumber, num);\n                };\n                handler(i);\n            });\n            if (this_1.options.enableHoverPreview) {\n                (function (num) {\n                    Dom_1.$$(cell).on('mouseover', function () { return _this.handleHoverIn(rowNumber, num); });\n                    Dom_1.$$(cell).on('mouseout', function () { return _this.handleHoverOut(rowNumber, num); });\n                })(i);\n            }\n            row.appendChild(cell);\n        };\n        var this_1 = this;\n        for (var i = 0; i < this.numberOfColumns; i++) {\n            _loop_1(i);\n        }\n        body.appendChild(row);\n    };\n    Matrix.prototype.handleHoverIn = function (rowNumber, columnNumber) {\n        var _this = this;\n        if (this.isHoverWorkingOnRow(rowNumber) && this.isHoverWorkingOnColumn(columnNumber)) {\n            this.previewTimeout = window.setTimeout(function () {\n                _this.displayResultsPreview(rowNumber, columnNumber);\n            }, this.options.previewDelay);\n        }\n    };\n    Matrix.prototype.handleHoverOut = function (rowNumber, columnNumber) {\n        clearTimeout(this.previewTimeout);\n        var cell = this.data[rowNumber][columnNumber];\n        cell.removePreview();\n    };\n    Matrix.prototype.displayResultsPreview = function (rowNumber, columnNumber) {\n        var _this = this;\n        var query = this.createPreviewQuery(rowNumber, columnNumber);\n        var cell = this.data[rowNumber][columnNumber];\n        cell.addPreview(this.options.previewMinWidth, this.options.previewMaxWidth);\n        var endpoint = this.queryController.getEndpoint();\n        endpoint.search(query).then(function (data) {\n            // During the time it take for the query to return, the matrix can change size depending\n            // on if another query was performed : Need to check for undefined before accessing the data\n            // we're trying to render;\n            if (!_this.isDataAvailable(rowNumber, columnNumber)) {\n                return;\n            }\n            var cell = _this.data[rowNumber][columnNumber];\n            var instantiatedResults = _.map(data.results, function (r) {\n                return _this.instantiateTemplate(r);\n            });\n            var html = '';\n            _.each(instantiatedResults, function (result) {\n                result.then(function (builtResultElement) {\n                    html += builtResultElement.outerHTML;\n                });\n            });\n            Promise.all(instantiatedResults).then(function () {\n                cell.updatePreview(html);\n            });\n        });\n    };\n    Matrix.prototype.instantiateTemplate = function (result) {\n        var _this = this;\n        return this.options.previewTemplate\n            .instantiateToElement(result, {\n            checkCondition: false,\n            responsiveComponents: this.searchInterface.responsiveComponents\n        })\n            .then(function (content) {\n            var initParameters = {\n                options: _this.options,\n                bindings: _this.getBindings(),\n                result: result\n            };\n            return Initialization_1.Initialization.automaticallyCreateComponentsInside(content, initParameters).initResult.then(function () {\n                return content;\n            });\n        });\n    };\n    Matrix.prototype.createPreviewQuery = function (rowNumber, columnNumber) {\n        var rowFieldExpression = '(' + QueryUtils_1.QueryUtils.buildFieldExpression(this.options.rowField, '=', [this.getRowValue(rowNumber)]) + ')';\n        var columnFieldExpression = '(' + QueryUtils_1.QueryUtils.buildFieldExpression(this.options.columnField, '=', [this.getColumnValue(columnNumber)]) + ')';\n        var query = this.queryController.getLastQuery();\n        query.aq = rowFieldExpression;\n        query.aq += columnFieldExpression;\n        query.sortCriteria = this.options.previewSortCriteria;\n        query.sortField = this.options.previewSortField;\n        var fieldSliced = this.options.computedField.slice(1);\n        var fieldExists = _.find(query.fieldsToInclude, function (field) {\n            return field == fieldSliced;\n        });\n        if (!fieldExists && query.fieldsToInclude) {\n            query.fieldsToInclude.push(fieldSliced);\n        }\n        return query;\n    };\n    Matrix.prototype.isHoverWorkingOnRow = function (rowNumber) {\n        if (this.options.enableColumnTotals) {\n            return rowNumber !== 0 && rowNumber !== this.numberOfRows - 1;\n        }\n        return rowNumber !== 0;\n    };\n    Matrix.prototype.isHoverWorkingOnColumn = function (columnNumber) {\n        if (this.options.enableRowTotals) {\n            return columnNumber !== 0 && columnNumber !== this.numberOfColumns - 1;\n        }\n        return columnNumber !== 0;\n    };\n    Matrix.prototype.isDataAvailable = function (row, column) {\n        return this.data[row] !== undefined && this.data[row][column] !== undefined;\n    };\n    Matrix.ID = 'Matrix';\n    Matrix.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            Matrix: Matrix\n        });\n    };\n    /**\n     * The possible options for the component\n     * @componentOptions\n     */\n    Matrix.options = {\n        /**\n         * Specifies the text to display at the top of the Matrix.\n         */\n        title: ComponentOptions_1.ComponentOptions.buildStringOption(),\n        /**\n         * Specifies the field to use for the rows.\n         *\n         * Specifying a value for this options is required for this component to work.\n         */\n        rowField: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true }),\n        /**\n         * Specifies the field to use for the columns.\n         *\n         * Specifying a value for this options is required for this component to work.\n         */\n        columnField: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true }),\n        /**\n         * Specifies the criteria to use for sorting the rows.\n         *\n         * See {@link IGroupByRequest.sortCriteria} for the list of possible values.\n         *\n         * Default value is `computedfielddescending`.\n         */\n        sortCriteria: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: 'computedfielddescending' }),\n        /**\n         * Specifies the maximum number of rows to display in the Matrix.\n         *\n         * Default value is `10`. Minimum value is `0`.\n         */\n        maximumNumberOfRows: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 10, min: 0 }),\n        /**\n         * Specifies whether to display a **Total** column containing the sum of each row.\n         *\n         * Default value is `true`.\n         */\n        enableRowTotals: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }),\n        /**\n         * Specifies the field values to use for each column.\n         *\n         * See also {@link Matrix.options.columnLabels}.\n         *\n         * Default value is `[]`, which means that the Matrix will not generate any column (except the **Total** column, if\n         * {@link Matrix.options.enableRowTotals} is `true`).\n         */\n        columnFieldValues: ComponentOptions_1.ComponentOptions.buildListOption({ defaultValue: [] }),\n        /**\n         * Specifies the label values to use for each column.\n         *\n         * Default value is `[]`. The array set for this options should match the {@link Matrix.options.columnFieldValues}.\n         */\n        columnLabels: ComponentOptions_1.ComponentOptions.buildListOption({ defaultValue: [] }),\n        /**\n         * Specifies the label for the first column on the left as a description of the {@link Matrix.options.columnField}.\n         *\n         * Default value is `undefined`.\n         */\n        columnHeader: ComponentOptions_1.ComponentOptions.buildStringOption(),\n        /**\n         * Specifies the maximum number of results to include in the {@link IGroupByRequest} for the columns.\n         *\n         * This value should always be greater than the {@link Matrix.options.maximumNumberOfRows}. If it is too small, some\n         * of the results will not be displayed in the Matrix.\n         *\n         * Default value is `100`. Minimum value is `0`.\n         */\n        maximumNumberOfValuesInGroupBy: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 100, min: 0 }),\n        /**\n         * Specifies whether to add a **Total** row containing the total of each column.\n         *\n         * Default value is `true`\n         */\n        enableColumnTotals: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }),\n        /**\n         * Specifies the field whose computed values you want to display in the cells.\n         *\n         * Specifying a value for this options is required for this component to work.\n         */\n        computedField: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true }),\n        /**\n         * Specifies the type of aggregate operation to perform on the {@link Matrix.options.computedField}.\n         *\n         * The possible values are:\n         * - `sum` - Computes the sum of the computed field values.\n         * - `average` - Computes the average of the computed field values.\n         * - `minimum` - Finds the minimum value of the computed field values.\n         * - `maximum` - Finds the maximum value of the computed field values.\n         *\n         * Default value is `sum`.\n         */\n        computedFieldOperation: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: 'sum' }),\n        /**\n         * Specifies how to format the values resulting from a {@link Matrix.options.computedFieldOperation}.\n         *\n         * The Globalize library defines all available formats (see\n         * [Globalize](https://github.com/klaaspieter/jquery-global#globalizeformat-value-format-culture-)).\n         *\n         * The most commonly used formats are:\n         * - `c0` - Formats the value as a currency.\n         * - `n0` - Formats the value as an integer.\n         * - `n2` - Formats the value as a floating point with 2 decimal digits.\n         *\n         * Default value is `c0`.\n         */\n        computedFieldFormat: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: 'c0' }),\n        /**\n         * Specifies the font-size to use for displaying text inside the cells.\n         *\n         * This option is mainly useful to prevent a Matrix containing many columns from cropping some of its values.\n         *\n         * However, instead of using this option to solve this kind of issue, you could also remove some of the less\n         * important columns from your Matrix or modify the CSS of your page to allow the Matrix to occupy a larger space.\n         *\n         * Default value is `''`.\n         */\n        cellFontSize: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: '' }),\n        /**\n         * Specifies whether to show a preview popup of cell results when hovering over a cell.\n         *\n         * See also {@link Matrix.options.previewSortCriteria}, {@link Matrix.options.previewMaxWidth},\n         * {@link Matrix.options.previewMinWidth}, {@link Matrix.options.previewDelay} and\n         * {@link Matrix.options.previewTemplate}.\n         *\n         * Default value is `true`.\n         */\n        enableHoverPreview: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true }),\n        /**\n         * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the criteria to use for sorting the results of\n         * the hover preview.\n         *\n         * The available sort criteria values are the same as those of the {@link IQuery}.\n         *\n         * The possible values are:\n         * - `relevancy`: Uses all configured ranking weights and any specified ranking expressions to sort the results.\n         * - `dateascending` / `datedescending`: Sorts the results using the `@date` field value, which is typically the\n         * last modification date of an item in the index.\n         * - `qre`: Sorts the results using only the weights applied by ranking expressions. Using `qre` is much like using\n         * `relevancy`, except that `qre` does not compute automatic weights, such as weights based on keyword proximity.\n         * - `nosort`: Does not sort the results. Using `nosort` returns the items in an essentially random order.\n         * - `fieldascending` / `fielddescending`: Sorts the results using the value of a custom field.\n         * - `fieldascending` / `fielddescending`: Sorts the results using the value of a custom field.\n         *\n         * See also {@link Matrix.options.previewSortField}.\n         *\n         * Default value is `FieldDescending`.\n         */\n        previewSortCriteria: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: 'FieldDescending' }),\n        /**\n         * If {@link Matrix.options.previewSortCriteria} is `fieldascending` or `fielddescending`, specifies the field to\n         * use for sorting the results of the hover preview.\n         *\n         * Default value is the value of {@link Matrix.options.computedField}.\n         */\n        previewSortField: ComponentOptions_1.ComponentOptions.buildFieldOption(),\n        /**\n         * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the maximum width (in pixels) of the preview\n         * popup.\n         *\n         * Default value is `500px`.\n         */\n        previewMaxWidth: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: '500px' }),\n        /**\n         * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the minimum width (in pixels) of the preview\n         * popup.\n         *\n         * Default value is `0`.\n         */\n        previewMinWidth: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: '0' }),\n        /**\n         * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the delay (in milliseconds) before sending the\n         * query to get the preview results.\n         *\n         * Default value is `500`.\n         */\n        previewDelay: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 500 }),\n        /**\n         * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the template ID or CSS selector of the template\n         * to use to render the results of the hover preview.\n         *\n         * You must use either `data-template-id` or `data-template-selector` in the markup to specify a value for this\n         * option.\n         *\n         * **Examples:**\n         *\n         * Specifying what template to use by referring to its template ID:\n         * ```html\n         * <div class='CoveoMatrix' data-template-id='TemplateId'></div>\n         * ```\n         *\n         * Specifying what template to use by referring to its CSS selector:\n         * ```html\n         * <div class='CoveoMatrix' data-template-selector='.templateSelector'></div>\n         * ```\n         */\n        previewTemplate: TemplateComponentOptions_1.TemplateComponentOptions.buildTemplateOption()\n    };\n    return Matrix;\n}(Component_1.Component));\nexports.Matrix = Matrix;\nInitialization_1.Initialization.registerAutoCreateComponent(Matrix);\n\n\n/***/ }),\n\n/***/ 627:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 628:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\n/**\n * Represent a single cell of data in the {@link Matrix} component.\n */\nvar Cell = /** @class */ (function () {\n    function Cell(value, el) {\n        if (value === void 0) { value = 0; }\n        this.previewActive = false;\n        this.element = el;\n        this.value = value;\n    }\n    /**\n     * Return the value of the cell.\n     * @returns {any}\n     */\n    Cell.prototype.getValue = function () {\n        return this.value;\n    };\n    /**\n     * Return the `HTMLElement` for the cell.\n     * @returns {HTMLElement}\n     */\n    Cell.prototype.getHTML = function () {\n        return this.element;\n    };\n    /**\n     * Set the value if the cell.\n     * @param value\n     */\n    Cell.prototype.setValue = function (value) {\n        this.value = value;\n    };\n    /**\n     * Set the `HTMLElement` for the cell.\n     * @param html\n     */\n    Cell.prototype.setHTML = function (html) {\n        this.element = html;\n    };\n    /**\n     * Show the preview of the cell.\n     * @param minWidth css minWidth property : eg 100px\n     * @param maxWidth css maxWidth property : eg 100px\n     */\n    Cell.prototype.addPreview = function (minWidth, maxWidth) {\n        this.previewActive = true;\n        var previewContainer = Dom_1.$$('div', {\n            className: 'matrix-results-preview-container'\n        });\n        previewContainer.el.style.minWidth = minWidth;\n        previewContainer.el.style.maxWidth = maxWidth;\n        previewContainer.on('click', function (e) {\n            e.stopPropagation();\n        });\n        this.element.appendChild(previewContainer.el);\n        var container = Dom_1.$$(this.element).findAll('.matrix-results-preview-container');\n        _.each(container, function (c) {\n            Dom_1.$$(c).hide();\n        });\n    };\n    /**\n     * Remove the preview of the cell\n     */\n    Cell.prototype.removePreview = function () {\n        this.previewActive = false;\n        var container = Dom_1.$$(this.element).find('.matrix-results-preview-container');\n        if (container) {\n            Dom_1.$$(container).detach();\n        }\n    };\n    /**\n     * Update the preview with a new template\n     * @param template\n     */\n    Cell.prototype.updatePreview = function (template) {\n        if (this.previewActive) {\n            var preview = Dom_1.$$(this.element).find('.matrix-results-preview-container');\n            preview.innerHTML += template;\n            Dom_1.$$(preview).show();\n        }\n    };\n    return Cell;\n}());\nexports.Cell = Cell;\n\n\n/***/ }),\n\n/***/ 629:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Template_1 = __webpack_require__(27);\nvar Dom_1 = __webpack_require__(1);\nvar Globalize = __webpack_require__(23);\nvar DefaultMatrixResultPreviewTemplate = /** @class */ (function (_super) {\n    __extends(DefaultMatrixResultPreviewTemplate, _super);\n    function DefaultMatrixResultPreviewTemplate(computedField, format) {\n        var _this = _super.call(this) || this;\n        _this.computedField = computedField;\n        _this.format = format;\n        return _this;\n    }\n    DefaultMatrixResultPreviewTemplate.prototype.instantiateToString = function (object, instantiateOptions) {\n        var preview = \"<div class='coveo-result-frame'>\" +\n            \"<div class='coveo-result-row'>\" +\n            \"<div class='coveo-result-cell' style='width: 40px; padding-right:5px;vertical-align: middle'>\" +\n            \"<a class='CoveoIcon' data-small='true'></a>\" +\n            '</div>' +\n            \"<div class='coveo-result-cell' style='font-size:13px;vertical-align: middle'>\" +\n            \"<a class='CoveoResultLink'></a>\" +\n            '</div>' +\n            \"<div class='coveo-result-cell' style='width:80px; text-align:right; font-size:13px; padding-right: 5px;vertical-align: middle'>\" +\n            Globalize.format(parseInt(object.raw[this.computedField.slice(1)]), this.format) +\n            '</div>' +\n            '</div>' +\n            '</div>';\n        return preview;\n    };\n    DefaultMatrixResultPreviewTemplate.prototype.instantiateToElement = function (object, instantiateOptions) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            return Dom_1.$$('div', undefined, _this.instantiateToString(object)).el;\n        });\n    };\n    return DefaultMatrixResultPreviewTemplate;\n}(Template_1.Template));\nexports.DefaultMatrixResultPreviewTemplate = DefaultMatrixResultPreviewTemplate;\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// Matrix.min__45edc409d97327d59af1.js","import * as Globalize from 'globalize';\nimport 'styling/_Matrix';\nimport * as _ from 'underscore';\nimport { IBuildingQueryEventArgs, IDoneBuildingQueryEventArgs, IQuerySuccessEventArgs, QueryEvents } from '../../events/QueryEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport { IGroupByRequest } from '../../rest/GroupByRequest';\nimport { IQuery } from '../../rest/Query';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { IQueryResults } from '../../rest/QueryResults';\nimport { $$ } from '../../utils/Dom';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { Utils } from '../../utils/Utils';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IFieldOption } from '../Base/IComponentOptions';\nimport { IInitializationParameters, Initialization } from '../Base/Initialization';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\nimport { Template } from '../Templates/Template';\nimport { Cell } from './Cell';\nimport { DefaultMatrixResultPreviewTemplate } from './DefaultMatrixResultPreviewTemplate';\n\nexport interface IMatrixOptions {\n  title?: string;\n\n  rowField: IFieldOption;\n  sortCriteria?: string;\n  maximumNumberOfRows?: number;\n  enableRowTotals?: boolean;\n\n  columnField: IFieldOption;\n  columnFieldValues?: string[];\n  columnLabels?: string[];\n  columnHeader?: string;\n  maximumNumberOfValuesInGroupBy?: number;\n  enableColumnTotals?: boolean;\n\n  computedField: IFieldOption;\n  computedFieldOperation?: string;\n  computedFieldFormat?: string;\n  cellFontSize?: string;\n\n  enableHoverPreview?: boolean;\n  previewSortCriteria?: string;\n  previewSortField?: IFieldOption;\n  previewMaxWidth?: string;\n  previewMinWidth?: string;\n  previewDelay?: number;\n  previewTemplate?: Template;\n}\n\n/**\n * The Matrix component uses the values of two fields (row and column) to display the results of the specified computed\n * field in a table.\n *\n * The user specifies the values to use for the columns. An {@link IGroupByRequest} operation performed at the same time\n * as the main query retrieves the values to use for the rows.\n *\n * In a way that is similar to the {@link Facet} component, selecting a Matrix cell allows the end user to drill down\n * inside the results by restricting the row field and the column field to match the values of the selected cell.\n *\n * @notSupportedIn salesforcefree\n */\nexport class Matrix extends Component {\n  static ID = 'Matrix';\n\n  static doExport = () => {\n    exportGlobally({\n      Matrix: Matrix\n    });\n  };\n\n  /**\n   * The possible options for the component\n   * @componentOptions\n   */\n  static options: IMatrixOptions = {\n    /**\n     * Specifies the text to display at the top of the Matrix.\n     */\n    title: ComponentOptions.buildStringOption(),\n\n    /**\n     * Specifies the field to use for the rows.\n     *\n     * Specifying a value for this options is required for this component to work.\n     */\n    rowField: ComponentOptions.buildFieldOption({ required: true }),\n\n    /**\n     * Specifies the field to use for the columns.\n     *\n     * Specifying a value for this options is required for this component to work.\n     */\n    columnField: ComponentOptions.buildFieldOption({ required: true }),\n\n    /**\n     * Specifies the criteria to use for sorting the rows.\n     *\n     * See {@link IGroupByRequest.sortCriteria} for the list of possible values.\n     *\n     * Default value is `computedfielddescending`.\n     */\n    sortCriteria: ComponentOptions.buildStringOption({ defaultValue: 'computedfielddescending' }),\n\n    /**\n     * Specifies the maximum number of rows to display in the Matrix.\n     *\n     * Default value is `10`. Minimum value is `0`.\n     */\n    maximumNumberOfRows: ComponentOptions.buildNumberOption({ defaultValue: 10, min: 0 }),\n\n    /**\n     * Specifies whether to display a **Total** column containing the sum of each row.\n     *\n     * Default value is `true`.\n     */\n    enableRowTotals: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n\n    /**\n     * Specifies the field values to use for each column.\n     *\n     * See also {@link Matrix.options.columnLabels}.\n     *\n     * Default value is `[]`, which means that the Matrix will not generate any column (except the **Total** column, if\n     * {@link Matrix.options.enableRowTotals} is `true`).\n     */\n    columnFieldValues: ComponentOptions.buildListOption<string>({ defaultValue: [] }),\n\n    /**\n     * Specifies the label values to use for each column.\n     *\n     * Default value is `[]`. The array set for this options should match the {@link Matrix.options.columnFieldValues}.\n     */\n    columnLabels: ComponentOptions.buildListOption<string>({ defaultValue: [] }),\n\n    /**\n     * Specifies the label for the first column on the left as a description of the {@link Matrix.options.columnField}.\n     *\n     * Default value is `undefined`.\n     */\n    columnHeader: ComponentOptions.buildStringOption(),\n\n    /**\n     * Specifies the maximum number of results to include in the {@link IGroupByRequest} for the columns.\n     *\n     * This value should always be greater than the {@link Matrix.options.maximumNumberOfRows}. If it is too small, some\n     * of the results will not be displayed in the Matrix.\n     *\n     * Default value is `100`. Minimum value is `0`.\n     */\n    maximumNumberOfValuesInGroupBy: ComponentOptions.buildNumberOption({ defaultValue: 100, min: 0 }),\n\n    /**\n     * Specifies whether to add a **Total** row containing the total of each column.\n     *\n     * Default value is `true`\n     */\n    enableColumnTotals: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n\n    /**\n     * Specifies the field whose computed values you want to display in the cells.\n     *\n     * Specifying a value for this options is required for this component to work.\n     */\n    computedField: ComponentOptions.buildFieldOption({ required: true }),\n\n    /**\n     * Specifies the type of aggregate operation to perform on the {@link Matrix.options.computedField}.\n     *\n     * The possible values are:\n     * - `sum` - Computes the sum of the computed field values.\n     * - `average` - Computes the average of the computed field values.\n     * - `minimum` - Finds the minimum value of the computed field values.\n     * - `maximum` - Finds the maximum value of the computed field values.\n     *\n     * Default value is `sum`.\n     */\n    computedFieldOperation: ComponentOptions.buildStringOption({ defaultValue: 'sum' }),\n\n    /**\n     * Specifies how to format the values resulting from a {@link Matrix.options.computedFieldOperation}.\n     *\n     * The Globalize library defines all available formats (see\n     * [Globalize](https://github.com/klaaspieter/jquery-global#globalizeformat-value-format-culture-)).\n     *\n     * The most commonly used formats are:\n     * - `c0` - Formats the value as a currency.\n     * - `n0` - Formats the value as an integer.\n     * - `n2` - Formats the value as a floating point with 2 decimal digits.\n     *\n     * Default value is `c0`.\n     */\n    computedFieldFormat: ComponentOptions.buildStringOption({ defaultValue: 'c0' }),\n\n    /**\n     * Specifies the font-size to use for displaying text inside the cells.\n     *\n     * This option is mainly useful to prevent a Matrix containing many columns from cropping some of its values.\n     *\n     * However, instead of using this option to solve this kind of issue, you could also remove some of the less\n     * important columns from your Matrix or modify the CSS of your page to allow the Matrix to occupy a larger space.\n     *\n     * Default value is `''`.\n     */\n    cellFontSize: ComponentOptions.buildStringOption({ defaultValue: '' }),\n\n    /**\n     * Specifies whether to show a preview popup of cell results when hovering over a cell.\n     *\n     * See also {@link Matrix.options.previewSortCriteria}, {@link Matrix.options.previewMaxWidth},\n     * {@link Matrix.options.previewMinWidth}, {@link Matrix.options.previewDelay} and\n     * {@link Matrix.options.previewTemplate}.\n     *\n     * Default value is `true`.\n     */\n    enableHoverPreview: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n\n    /**\n     * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the criteria to use for sorting the results of\n     * the hover preview.\n     *\n     * The available sort criteria values are the same as those of the {@link IQuery}.\n     *\n     * The possible values are:\n     * - `relevancy`: Uses all configured ranking weights and any specified ranking expressions to sort the results.\n     * - `dateascending` / `datedescending`: Sorts the results using the `@date` field value, which is typically the\n     * last modification date of an item in the index.\n     * - `qre`: Sorts the results using only the weights applied by ranking expressions. Using `qre` is much like using\n     * `relevancy`, except that `qre` does not compute automatic weights, such as weights based on keyword proximity.\n     * - `nosort`: Does not sort the results. Using `nosort` returns the items in an essentially random order.\n     * - `fieldascending` / `fielddescending`: Sorts the results using the value of a custom field.\n     * - `fieldascending` / `fielddescending`: Sorts the results using the value of a custom field.\n     *\n     * See also {@link Matrix.options.previewSortField}.\n     *\n     * Default value is `FieldDescending`.\n     */\n    previewSortCriteria: ComponentOptions.buildStringOption({ defaultValue: 'FieldDescending' }),\n\n    /**\n     * If {@link Matrix.options.previewSortCriteria} is `fieldascending` or `fielddescending`, specifies the field to\n     * use for sorting the results of the hover preview.\n     *\n     * Default value is the value of {@link Matrix.options.computedField}.\n     */\n    previewSortField: ComponentOptions.buildFieldOption(),\n\n    /**\n     * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the maximum width (in pixels) of the preview\n     * popup.\n     *\n     * Default value is `500px`.\n     */\n    previewMaxWidth: ComponentOptions.buildStringOption({ defaultValue: '500px' }),\n\n    /**\n     * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the minimum width (in pixels) of the preview\n     * popup.\n     *\n     * Default value is `0`.\n     */\n    previewMinWidth: ComponentOptions.buildStringOption({ defaultValue: '0' }),\n\n    /**\n     * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the delay (in milliseconds) before sending the\n     * query to get the preview results.\n     *\n     * Default value is `500`.\n     */\n    previewDelay: ComponentOptions.buildNumberOption({ defaultValue: 500 }),\n\n    /**\n     * If {@link Matrix.options.enableHoverPreview} is `true`, specifies the template ID or CSS selector of the template\n     * to use to render the results of the hover preview.\n     *\n     * You must use either `data-template-id` or `data-template-selector` in the markup to specify a value for this\n     * option.\n     *\n     * **Examples:**\n     *\n     * Specifying what template to use by referring to its template ID:\n     * ```html\n     * <div class='CoveoMatrix' data-template-id='TemplateId'></div>\n     * ```\n     *\n     * Specifying what template to use by referring to its CSS selector:\n     * ```html\n     * <div class='CoveoMatrix' data-template-selector='.templateSelector'></div>\n     * ```\n     */\n    previewTemplate: TemplateComponentOptions.buildTemplateOption()\n  };\n\n  /**\n   * Holds the data for the Matrix.\n   */\n  public data: Cell[][];\n  public groupByIndex = [];\n  public rowId = '';\n  public columnId = '';\n\n  /**\n   * The currently selected row value, or `undefined` if nothing is selected.\n   */\n  public selectedRowValue: string = undefined;\n\n  /**\n   * The currently selected column value, or `undefined` if nothing is selected.\n   */\n  public selectedColumnValue = undefined;\n\n  private numberOfRows = 0;\n  private numberOfColumns = 0;\n  private previewTimeout: number;\n\n  /**\n   * Creates a new Matrix. Also verifies whether options are valid and coherent. Binds query events.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the Matrix component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  constructor(public element: HTMLElement, public options?: IMatrixOptions, bindings?: IComponentBindings) {\n    super(element, Matrix.ID, bindings);\n    this.options = ComponentOptions.initComponentOptions(element, Matrix, options);\n\n    if (!this.options.previewTemplate) {\n      this.options.previewTemplate = new DefaultMatrixResultPreviewTemplate(\n        <string>this.options.computedField,\n        this.options.computedFieldFormat\n      );\n    }\n\n    if (!this.options.previewSortField) {\n      this.options.previewSortField = <string>this.options.computedField;\n    }\n\n    if (this.options.columnFieldValues.length != this.options.columnLabels.length) {\n      this.options.columnLabels = this.options.columnFieldValues;\n    }\n\n    this.buildMatrix();\n    if (this.options.rowField == null) {\n      this.logger.error(\"'rowField' option is required in the Matrix component\");\n    } else if (this.options.columnField == null) {\n      this.logger.error(\"'columnField' option is required in the Matrix component\");\n    } else if (this.options.computedField == null) {\n      this.logger.error(\"'computedField' option is required in the Matrix component\");\n    } else {\n      this.bindEvents();\n      this.initQueryState();\n    }\n  }\n\n  /**\n   * Selects a cell by its row and column number. Does not execute a query.\n   * @param rowNumber The row number of the cell to select.\n   * @param columnNumber The column number of the cell to select.\n   */\n  public selectCell(rowNumber: number, columnNumber: number): void {\n    let rowValue, columnValue;\n    if (rowNumber !== 0 && rowNumber !== this.numberOfRows - 1) {\n      rowValue = this.getRowValue(rowNumber);\n    }\n\n    if (columnNumber !== 0 && columnNumber !== this.numberOfColumns - 1) {\n      columnValue = this.getColumnValue(columnNumber);\n    }\n\n    if (rowValue && this.isRowFacetPresent()) {\n      this.queryStateModel.set(this.rowId, [rowValue]);\n    } else {\n      this.selectedRowValue = rowValue;\n      this.queryStateModel.set(this.rowId, []);\n    }\n\n    if (columnValue && this.isColumnFacetPresent()) {\n      this.queryStateModel.set(this.columnId, [columnValue]);\n    } else {\n      this.selectedColumnValue = columnValue;\n      this.queryStateModel.set(this.columnId, []);\n    }\n  }\n\n  /**\n   * Returns the currently selected column value.\n   */\n  public getSelectedColumnValue(): string {\n    return this.selectedColumnValue;\n  }\n\n  /**\n   * Returns the currently selected row value.\n   */\n  public getSelectedRowValue(): string {\n    return this.selectedRowValue;\n  }\n\n  /**\n   * Gets the HTMLElement associated to a cell.\n   * @param rowNumber The row number of the cell.\n   * @param columnNumber The column number of the cell.\n   * @returns {HTMLElement} The associated HTMLElement.\n   */\n  public getCellElement(rowNumber: number, columnNumber: number): HTMLElement {\n    return this.data[rowNumber][columnNumber].getHTML();\n  }\n\n  /**\n   * Gets the string associated to a cell.\n   * @param rowNumber The row number of the cell.\n   * @param columnNumber The column number of the cell.\n   * @returns {string} The associated string.\n   */\n  public getCellValue(rowNumber: number, columnNumber: number): string {\n    let cell = this.getCellElement(rowNumber, columnNumber);\n    return $$(cell).text();\n  }\n\n  public drawMatrix() {\n    let headerRow = $$('div', {\n      className: 'coveo-matrix-row matrix-header-row'\n    });\n    this.drawRow(headerRow.el, 0);\n    let numberOfRowsToDraw = this.options.enableColumnTotals ? this.numberOfRows - 1 : this.numberOfRows;\n    for (let i = 1; i < numberOfRowsToDraw; i++) {\n      let row = $$('div', {\n        className: 'coveo-matrix-row'\n      }).el;\n      this.drawRow(row, i);\n    }\n\n    if (this.options.enableColumnTotals) {\n      let totalRow = $$('div', {\n        className: 'coveo-matrix-row matrix-total-row'\n      }).el;\n\n      this.drawRow(totalRow, this.numberOfRows - 1);\n    }\n\n    if (this.options.cellFontSize !== '') {\n      let cells = $$(this.element).findAll('.coveo-matrix-cell');\n      _.each(cells, (c: HTMLElement) => {\n        c.style.fontSize = this.options.cellFontSize;\n      });\n    }\n  }\n\n  private bindEvents() {\n    this.bind.onRootElement(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) => this.handleBuildingQuery(args));\n    this.bind.onRootElement(QueryEvents.doneBuildingQuery, (args: IDoneBuildingQueryEventArgs) => this.handleDoneBuildingQuery(args));\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, (args: IQuerySuccessEventArgs) => this.handleDeferredQuerySuccess(args));\n  }\n\n  private initQueryState() {\n    this.rowId = QueryStateModel.getFacetId(<string>this.options.rowField);\n    this.columnId = QueryStateModel.getFacetId(<string>this.options.columnField);\n\n    this.queryStateModel.registerNewAttribute(this.rowId, []);\n    this.queryStateModel.registerNewAttribute(this.columnId, []);\n  }\n\n  private buildMatrix() {\n    this.buildTitle();\n    this.buildBody();\n    this.data = new Array<Array<Cell>>();\n    this.addHeaderRow();\n  }\n\n  private buildTitle() {\n    let title = this.options.title ? this.options.title : '';\n    let titleHtml = $$(\n      'div',\n      {\n        className: 'coveo-matrix-title'\n      },\n      title\n    ).el;\n    this.element.appendChild(titleHtml);\n  }\n\n  private buildBody() {\n    let body = $$('div', {\n      className: 'coveo-matrix'\n    }).el;\n    this.element.appendChild(body);\n  }\n\n  private handleBuildingQuery(args: IBuildingQueryEventArgs) {\n    if (!this.areFacetsPresent()) {\n      if (this.selectedRowValue && !this.isRowFacetPresent()) {\n        args.queryBuilder.advancedExpression.addFieldExpression(<string>this.options.rowField, '=', [this.selectedRowValue]);\n      }\n      if (this.selectedColumnValue && !this.isColumnFacetPresent()) {\n        args.queryBuilder.advancedExpression.addFieldExpression(<string>this.options.columnField, '=', [this.selectedColumnValue]);\n      }\n    }\n  }\n\n  private handleDoneBuildingQuery(args: IDoneBuildingQueryEventArgs) {\n    this.groupByIndex = [];\n    this.addMainGroubByRequest(args.queryBuilder);\n    this.addColumnsGroupByRequests(args.queryBuilder);\n  }\n\n  private handleDeferredQuerySuccess(args: IQuerySuccessEventArgs) {\n    this.reset();\n    this.parseResults(args.results);\n    this.addTotals();\n    this.drawMatrix();\n    this.formatCells();\n    this.selectedRowValue = undefined;\n    this.selectedColumnValue = undefined;\n  }\n\n  private addMainGroubByRequest(queryBuilder: QueryBuilder) {\n    let groupBy: IGroupByRequest = {\n      field: <string>this.options.rowField,\n      sortCriteria: this.options.sortCriteria,\n      computedFields: this.getComputedFields(),\n      maximumNumberOfValues: this.options.maximumNumberOfRows\n    };\n\n    this.groupByIndex.push(queryBuilder.groupByRequests.length);\n    queryBuilder.groupByRequests.push(groupBy);\n  }\n\n  private addColumnsGroupByRequests(queryBuilder: QueryBuilder) {\n    for (let i = 0; i < this.options.columnFieldValues.length; i++) {\n      let groupBy = {\n        field: <string>this.options.rowField,\n        sortCriteria: this.options.sortCriteria,\n        computedFields: this.getComputedFields(),\n        queryOverride:\n          '(' + this.buildExpression(queryBuilder) + ')' + '(' + this.options.columnField + \"='\" + this.options.columnFieldValues[i] + \"')\",\n        maximumNumberOfValues: this.options.maximumNumberOfValuesInGroupBy\n      };\n\n      this.groupByIndex.push(queryBuilder.groupByRequests.length);\n      queryBuilder.groupByRequests.push(groupBy);\n    }\n  }\n\n  private buildExpression(queryBuilder: QueryBuilder) {\n    let expression = queryBuilder.expression.build();\n    let advancedExpression = queryBuilder.advancedExpression.build();\n    let constantExpression = queryBuilder.constantExpression.build();\n    let totalQuery = '';\n    if (expression) {\n      totalQuery += ' ' + expression;\n    }\n    if (advancedExpression) {\n      totalQuery += ' ' + advancedExpression;\n    }\n    if (constantExpression) {\n      totalQuery += ' ' + constantExpression;\n    }\n    return totalQuery;\n  }\n\n  private getComputedFields() {\n    let computedFields = [\n      {\n        field: <string>this.options.computedField,\n        operation: this.options.computedFieldOperation\n      }\n    ];\n    return computedFields;\n  }\n\n  private getCellResult(results, rowNumber: number, columnNumber: number) {\n    let rowValue = this.getRowValue(rowNumber);\n    let columnValue = this.getColumnValue(columnNumber);\n    let cellResult = 0;\n\n    for (let i = 0; i < results.values.length; i++) {\n      if (results.values[i].value === rowValue) {\n        cellResult = results.values[i].computedFieldResults[0];\n        break;\n      }\n    }\n\n    if (this.isAColumnSelected() && !this.isColumnSelected(columnValue)) {\n      cellResult = 0;\n    }\n\n    return cellResult;\n  }\n\n  private addTotals() {\n    if (this.options.enableRowTotals) {\n      this.addRowTotals();\n    }\n    if (this.options.enableColumnTotals) {\n      this.addColumnTotals();\n    }\n  }\n\n  private addRowTotals() {\n    this.addColumn();\n    this.setValue('Total', 0, this.numberOfColumns - 1);\n    for (let i = 1; i < this.numberOfRows; i++) {\n      let rowTotal = this.computeRowTotal(i);\n      this.setValue(rowTotal, i, this.numberOfColumns - 1);\n    }\n\n    // Fix sort ordering when not all columns field values are present.\n    if (this.options.sortCriteria.toLowerCase() == 'computedfielddescending') {\n      this.data.sort((a: Cell[], b: Cell[]): number => {\n        return b[this.numberOfColumns - 1].getValue() - a[this.numberOfColumns - 1].getValue();\n      });\n    }\n\n    if (this.options.sortCriteria.toLowerCase() == 'computedfieldascending') {\n      this.data.sort((a: Cell[], b: Cell[]): number => {\n        return a[this.numberOfColumns - 1].getValue() - b[this.numberOfColumns - 1].getValue();\n      });\n    }\n  }\n\n  private addColumnTotals() {\n    this.addRow();\n    this.setValue('Total', this.numberOfRows - 1, 0);\n    for (let i = 1; i < this.numberOfColumns; i++) {\n      let columnTotal = this.computeColumnTotal(i);\n      this.setValue(columnTotal, this.numberOfRows - 1, i);\n    }\n  }\n\n  private computeRowTotal(rowNumber: number): number {\n    let total = 0;\n    for (let columnNumber = 1; columnNumber < this.numberOfColumns - 1; columnNumber++) {\n      total += parseInt(this.getCellValue(rowNumber, columnNumber));\n    }\n    return total;\n  }\n\n  private computeColumnTotal(columnNumber: number): number {\n    let total = 0;\n    for (let rowNumber = 1; rowNumber < this.numberOfRows - 1; rowNumber++) {\n      total += parseInt(this.getCellValue(rowNumber, columnNumber));\n    }\n    return total;\n  }\n\n  private formatCells() {\n    for (let i = 1; i < this.numberOfRows; i++) {\n      for (let j = 1; j < this.numberOfColumns; j++) {\n        let cellValue = this.getCellValue(i, j);\n        cellValue = Globalize.format(parseInt(cellValue), this.options.computedFieldFormat);\n        this.setValue(cellValue, i, j);\n      }\n    }\n  }\n\n  private addHeaderRow() {\n    this.addRow();\n    this.addColumn();\n    this.setValue(this.options.columnHeader, 0, 0);\n    for (let i = 0; i < this.options.columnLabels.length; i++) {\n      this.addColumn();\n      this.setValue(this.options.columnLabels[i], 0, i + 1);\n    }\n  }\n\n  private addRow() {\n    this.data.push(new Array<Cell>());\n\n    for (let i = 0; i < this.numberOfColumns; i++) {\n      this.addCellToRow(this.numberOfRows, i);\n    }\n    this.numberOfRows++;\n  }\n\n  private addColumn() {\n    for (let i = 0; i < this.numberOfRows; i++) {\n      this.addCellToRow(i, this.numberOfColumns);\n    }\n\n    this.numberOfColumns++;\n  }\n\n  private addCellToRow(rowNumber: number, columnNumber: number) {\n    let column = $$('div', {\n      className: 'coveo-matrix-cell'\n    });\n\n    if (columnNumber == 0) {\n      column.addClass('matrix-first-column');\n    }\n    this.data[rowNumber].push(new Cell(0, column.el));\n  }\n\n  private setValue(value: any, rowNumber: number, columnNumber: number) {\n    let cell = this.getCellElement(rowNumber, columnNumber);\n    if (!Utils.isNullOrUndefined(value)) {\n      $$(cell).text(value.toString());\n    }\n\n    if (this.isCellSelected(this.getRowValue(rowNumber), this.getColumnValue(columnNumber))) {\n      $$(cell).addClass('coveo-matrix-selected');\n    }\n\n    if (this.isAColumnSelected() && !this.isColumnSelected(this.getColumnValue(columnNumber))) {\n      if (columnNumber != 0 && rowNumber != 0) {\n        $$(cell).addClass('coveo-matrix-unimportant');\n      }\n    }\n\n    this.data[rowNumber][columnNumber].setValue(value);\n  }\n\n  private handleClick(rowNumber: number, columnNumber: number) {\n    this.selectCell(rowNumber, columnNumber);\n    this.queryController.executeQuery();\n  }\n\n  private getRowValue(rowNumber: number): string {\n    return this.data[rowNumber][0].getValue();\n  }\n\n  private getColumnValue(columnNumber: number): string {\n    return this.options.columnFieldValues[columnNumber - 1];\n  }\n\n  private isAColumnSelected(): boolean {\n    let selectedColumnValues = this.queryStateModel.get(this.columnId) || [];\n    return selectedColumnValues.length !== 0 || this.selectedColumnValue != undefined;\n  }\n\n  private isColumnSelected(columnValue: string): boolean {\n    if (this.isAColumnSelected() && columnValue) {\n      let selectedColumnValues = this.queryStateModel.attributes[this.columnId] || [];\n      for (let i = 0; i < selectedColumnValues.length; i++) {\n        if (selectedColumnValues[i].toLowerCase() === columnValue.toLowerCase()) {\n          return true;\n        }\n      }\n    }\n    return this.selectedColumnValue == columnValue;\n  }\n\n  private isARowSelected(): boolean {\n    let selectedRowValues = this.queryStateModel.get(this.rowId) || [];\n    return selectedRowValues.length !== 0 || this.selectedRowValue !== undefined;\n  }\n\n  private isRowSelected(rowValue: string): boolean {\n    if (this.isARowSelected() && rowValue) {\n      let selectedRowValues = this.queryStateModel.get(this.rowId) || [];\n      for (let i = 0; i < selectedRowValues.length; i++) {\n        if (selectedRowValues[i].toLowerCase() === rowValue.toLowerCase()) {\n          return true;\n        }\n      }\n    }\n    return this.selectedRowValue == rowValue;\n  }\n\n  private isCellSelected(rowValue: string, columnValue: string): boolean {\n    if (this.isAColumnSelected() && this.isARowSelected()) {\n      return this.isRowSelected(rowValue) && this.isColumnSelected(columnValue);\n    } else if (this.isAColumnSelected()) {\n      return this.isColumnSelected(columnValue);\n    }\n\n    return false;\n  }\n\n  private areFacetsPresent() {\n    return this.isRowFacetPresent() && this.isColumnFacetPresent();\n  }\n\n  private isRowFacetPresent() {\n    let facet = this.componentStateModel.get(this.rowId);\n    return facet && !facet[0].disabled;\n  }\n\n  private isColumnFacetPresent() {\n    let facet = this.componentStateModel.get(this.columnId);\n    return facet && !facet[0].disabled;\n  }\n\n  private reset() {\n    $$(this.element).empty();\n    this.numberOfRows = 0;\n    this.numberOfColumns = 0;\n    this.data = new Array<Array<Cell>>();\n\n    this.buildMatrix();\n  }\n\n  private parseResults(results: IQueryResults) {\n    if (results) {\n      let mainResults = results.groupByResults[this.groupByIndex[0]];\n      if (mainResults) {\n        for (let i = 0; i < mainResults.values.length; i++) {\n          let value = mainResults.values[i].value;\n          this.addRow();\n          this.setValue(value, i + 1, 0);\n        }\n      }\n\n      for (let i = 1; i < this.numberOfRows; i++) {\n        for (let j = 1; j < this.numberOfColumns; j++) {\n          let columnResult = results.groupByResults[this.groupByIndex[j]];\n          let cellValue = this.getCellResult(columnResult, i, j);\n          this.setValue(cellValue, i, j);\n        }\n      }\n    }\n  }\n\n  private drawRow(row: HTMLElement, rowNumber: number) {\n    let body = $$(this.element).find('.coveo-matrix');\n    for (let i = 0; i < this.numberOfColumns; i++) {\n      let cell = this.data[rowNumber][i].getHTML();\n      $$(cell).on('click', () => {\n        let handler = num => {\n          this.handleClick(rowNumber, num);\n        };\n        handler(i);\n      });\n\n      if (this.options.enableHoverPreview) {\n        ((num: number) => {\n          $$(cell).on('mouseover', () => this.handleHoverIn(rowNumber, num));\n          $$(cell).on('mouseout', () => this.handleHoverOut(rowNumber, num));\n        })(i);\n      }\n      row.appendChild(cell);\n    }\n    body.appendChild(row);\n  }\n\n  private handleHoverIn(rowNumber: number, columnNumber: number) {\n    if (this.isHoverWorkingOnRow(rowNumber) && this.isHoverWorkingOnColumn(columnNumber)) {\n      this.previewTimeout = window.setTimeout(() => {\n        this.displayResultsPreview(rowNumber, columnNumber);\n      }, this.options.previewDelay);\n    }\n  }\n\n  private handleHoverOut(rowNumber: number, columnNumber: number) {\n    clearTimeout(this.previewTimeout);\n    let cell = this.data[rowNumber][columnNumber];\n    cell.removePreview();\n  }\n\n  private displayResultsPreview(rowNumber: number, columnNumber: number) {\n    let query = this.createPreviewQuery(rowNumber, columnNumber);\n    let cell = this.data[rowNumber][columnNumber];\n    cell.addPreview(this.options.previewMinWidth, this.options.previewMaxWidth);\n\n    let endpoint = this.queryController.getEndpoint();\n    endpoint.search(query).then((data: IQueryResults) => {\n      // During the time it take for the query to return, the matrix can change size depending\n      // on if another query was performed : Need to check for undefined before accessing the data\n      // we're trying to render;\n      if (!this.isDataAvailable(rowNumber, columnNumber)) {\n        return;\n      }\n      let cell = this.data[rowNumber][columnNumber];\n      let instantiatedResults = _.map(data.results, (r: IQueryResult) => {\n        return this.instantiateTemplate(r);\n      });\n      let html = '';\n      _.each(instantiatedResults, result => {\n        result.then((builtResultElement: HTMLElement) => {\n          html += builtResultElement.outerHTML;\n        });\n      });\n      Promise.all(instantiatedResults).then(() => {\n        cell.updatePreview(html);\n      });\n    });\n  }\n\n  private instantiateTemplate(result: IQueryResult): Promise<HTMLElement> {\n    return this.options.previewTemplate\n      .instantiateToElement(result, {\n        checkCondition: false,\n        responsiveComponents: this.searchInterface.responsiveComponents\n      })\n      .then((content: HTMLElement) => {\n        let initParameters: IInitializationParameters = {\n          options: this.options,\n          bindings: this.getBindings(),\n          result: result\n        };\n\n        return Initialization.automaticallyCreateComponentsInside(content, initParameters).initResult.then(() => {\n          return content;\n        });\n      });\n  }\n\n  private createPreviewQuery(rowNumber: number, columnNumber: number): IQuery {\n    let rowFieldExpression = '(' + QueryUtils.buildFieldExpression(<string>this.options.rowField, '=', [this.getRowValue(rowNumber)]) + ')';\n    let columnFieldExpression =\n      '(' + QueryUtils.buildFieldExpression(<string>this.options.columnField, '=', [this.getColumnValue(columnNumber)]) + ')';\n    let query = this.queryController.getLastQuery();\n    query.aq = rowFieldExpression;\n    query.aq += columnFieldExpression;\n    query.sortCriteria = this.options.previewSortCriteria;\n    query.sortField = <string>this.options.previewSortField;\n    let fieldSliced = this.options.computedField.slice(1);\n    let fieldExists = _.find(query.fieldsToInclude, (field: string) => {\n      return field == fieldSliced;\n    });\n    if (!fieldExists && query.fieldsToInclude) {\n      query.fieldsToInclude.push(fieldSliced);\n    }\n    return query;\n  }\n\n  private isHoverWorkingOnRow(rowNumber: number) {\n    if (this.options.enableColumnTotals) {\n      return rowNumber !== 0 && rowNumber !== this.numberOfRows - 1;\n    }\n    return rowNumber !== 0;\n  }\n\n  private isHoverWorkingOnColumn(columnNumber: number) {\n    if (this.options.enableRowTotals) {\n      return columnNumber !== 0 && columnNumber !== this.numberOfColumns - 1;\n    }\n    return columnNumber !== 0;\n  }\n\n  private isDataAvailable(row: number, column: number) {\n    return this.data[row] !== undefined && this.data[row][column] !== undefined;\n  }\n}\n\nInitialization.registerAutoCreateComponent(Matrix);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Matrix/Matrix.ts","import { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\n\n/**\n * Represent a single cell of data in the {@link Matrix} component.\n */\nexport class Cell {\n  private value: any;\n  private element: HTMLElement;\n  private previewActive = false;\n\n  constructor(value: any = 0, el?: HTMLElement) {\n    this.element = el;\n    this.value = value;\n  }\n\n  /**\n   * Return the value of the cell.\n   * @returns {any}\n   */\n  public getValue(): any {\n    return this.value;\n  }\n\n  /**\n   * Return the `HTMLElement` for the cell.\n   * @returns {HTMLElement}\n   */\n  public getHTML(): HTMLElement {\n    return this.element;\n  }\n\n  /**\n   * Set the value if the cell.\n   * @param value\n   */\n  public setValue(value: any) {\n    this.value = value;\n  }\n\n  /**\n   * Set the `HTMLElement` for the cell.\n   * @param html\n   */\n  public setHTML(html: HTMLElement) {\n    this.element = html;\n  }\n\n  /**\n   * Show the preview of the cell.\n   * @param minWidth css minWidth property : eg 100px\n   * @param maxWidth css maxWidth property : eg 100px\n   */\n  public addPreview(minWidth: string, maxWidth: string) {\n    this.previewActive = true;\n    let previewContainer = $$('div', {\n      className: 'matrix-results-preview-container'\n    });\n    previewContainer.el.style.minWidth = minWidth;\n    previewContainer.el.style.maxWidth = maxWidth;\n    previewContainer.on('click', (e: MouseEvent) => {\n      e.stopPropagation();\n    });\n    this.element.appendChild(previewContainer.el);\n    let container = $$(this.element).findAll('.matrix-results-preview-container');\n    _.each(container, (c: HTMLElement) => {\n      $$(c).hide();\n    });\n  }\n\n  /**\n   * Remove the preview of the cell\n   */\n  public removePreview() {\n    this.previewActive = false;\n    let container = $$(this.element).find('.matrix-results-preview-container');\n    if (container) {\n      $$(container).detach();\n    }\n  }\n\n  /**\n   * Update the preview with a new template\n   * @param template\n   */\n  public updatePreview(template: string) {\n    if (this.previewActive) {\n      let preview = $$(this.element).find('.matrix-results-preview-container');\n      preview.innerHTML += template;\n      $$(preview).show();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Matrix/Cell.ts","import { Template, IInstantiateTemplateOptions } from '../Templates/Template';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { $$ } from '../../utils/Dom';\nimport * as Globalize from 'globalize';\n\nexport class DefaultMatrixResultPreviewTemplate extends Template {\n  constructor(private computedField: string, private format: string) {\n    super();\n  }\n\n  instantiateToString(object?: IQueryResult, instantiateOptions?: IInstantiateTemplateOptions): string {\n    var preview =\n      \"<div class='coveo-result-frame'>\" +\n      \"<div class='coveo-result-row'>\" +\n      \"<div class='coveo-result-cell' style='width: 40px; padding-right:5px;vertical-align: middle'>\" +\n      \"<a class='CoveoIcon' data-small='true'></a>\" +\n      '</div>' +\n      \"<div class='coveo-result-cell' style='font-size:13px;vertical-align: middle'>\" +\n      \"<a class='CoveoResultLink'></a>\" +\n      '</div>' +\n      \"<div class='coveo-result-cell' style='width:80px; text-align:right; font-size:13px; padding-right: 5px;vertical-align: middle'>\" +\n      Globalize.format(parseInt(object.raw[this.computedField.slice(1)]), this.format) +\n      '</div>' +\n      '</div>' +\n      '</div>';\n    return preview;\n  }\n\n  instantiateToElement(object?: IQueryResult, instantiateOptions?: IInstantiateTemplateOptions): Promise<HTMLElement> {\n    return new Promise((resolve, reject) => {\n      return $$('div', undefined, this.instantiateToString(object)).el;\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Matrix/DefaultMatrixResultPreviewTemplate.ts"],"sourceRoot":""}